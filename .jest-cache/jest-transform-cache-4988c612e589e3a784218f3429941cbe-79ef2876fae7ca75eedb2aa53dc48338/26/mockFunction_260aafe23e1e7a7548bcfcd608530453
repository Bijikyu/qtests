f8bbcfb6b55dde86734db0444f0ebbb3
"use strict";
/**
 * Mock Functions - Call Tracking and Implementation Control
 *
 * This module provides Jest/Sinon-compatible mock function functionality
 * with call tracking, return value control, and implementation replacement.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.fn = fn;
exports.resetGlobalCallOrder = resetGlobalCallOrder;
// Global call order counter for tracking invocation order across all mocks
let globalCallOrder = 0;
/**
 * Create a mock function with call tracking and implementation control
 */
function fn(implementation) {
    // Mock state
    const calls = [];
    const results = [];
    const instances = [];
    const contexts = [];
    const invocationCallOrder = [];
    // Implementation state
    let currentImplementation = implementation;
    let returnValue = undefined;
    let hasReturnValue = false;
    let oneTimeReturnValues = [];
    let oneTimeImplementations = [];
    let resolvedValue = undefined;
    let hasResolvedValue = false;
    let oneTimeResolvedValues = [];
    let rejectedValue = undefined;
    let hasRejectedValue = false;
    let oneTimeRejectedValues = [];
    // The actual mock function
    function mockFunction(...args) {
        // Record the call
        calls.push(args);
        contexts.push(this);
        instances.push(this);
        invocationCallOrder.push(++globalCallOrder);
        let result;
        let resultType = 'return';
        try {
            // Determine what to execute
            let fnToExecute;
            // Check for one-time implementations first
            if (oneTimeImplementations.length > 0) {
                fnToExecute = oneTimeImplementations.shift();
            }
            else if (currentImplementation) {
                fnToExecute = currentImplementation;
            }
            // Execute implementation if available
            if (fnToExecute) {
                result = fnToExecute.apply(this, args);
            }
            else {
                // Handle return values and promises
                if (oneTimeReturnValues.length > 0) {
                    result = oneTimeReturnValues.shift();
                }
                else if (hasReturnValue) {
                    result = returnValue;
                }
                else if (oneTimeResolvedValues.length > 0) {
                    result = Promise.resolve(oneTimeResolvedValues.shift());
                }
                else if (hasResolvedValue) {
                    result = Promise.resolve(resolvedValue);
                }
                else if (oneTimeRejectedValues.length > 0) {
                    result = Promise.reject(oneTimeRejectedValues.shift());
                }
                else if (hasRejectedValue) {
                    result = Promise.reject(rejectedValue);
                }
                else {
                    result = undefined;
                }
            }
            // Handle rejected promises by converting to thrown errors for consistent tracking
            if (result && typeof result.then === 'function') {
                result.catch((error) => {
                    // Update the result type for promise rejections
                    const lastResultIndex = results.length - 1;
                    if (lastResultIndex >= 0) {
                        results[lastResultIndex] = { type: 'throw', value: error };
                    }
                });
            }
        }
        catch (error) {
            result = error;
            resultType = 'throw';
            // Re-throw the error after recording it
            results.push({ type: resultType, value: result });
            throw error;
        }
        // Record the result
        results.push({ type: resultType, value: result });
        return result;
    }
    // Add mock control methods to the function
    const mockAPI = {
        calls,
        results,
        instances,
        contexts,
        invocationCallOrder,
        mockReturnValue(value) {
            returnValue = value;
            hasReturnValue = true;
            return this;
        },
        mockReturnValueOnce(value) {
            oneTimeReturnValues.push(value);
            return this;
        },
        mockResolvedValue(value) {
            resolvedValue = value;
            hasResolvedValue = true;
            return this;
        },
        mockResolvedValueOnce(value) {
            oneTimeResolvedValues.push(value);
            return this;
        },
        mockRejectedValue(value) {
            rejectedValue = value;
            hasRejectedValue = true;
            return this;
        },
        mockRejectedValueOnce(value) {
            oneTimeRejectedValues.push(value);
            return this;
        },
        mockImplementation(fn) {
            currentImplementation = fn;
            return this;
        },
        mockImplementationOnce(fn) {
            oneTimeImplementations.push(fn);
            return this;
        },
        toHaveBeenCalled() {
            return calls.length > 0;
        },
        toHaveBeenCalledWith(...args) {
            return calls.some(call => call.length === args.length &&
                call.every((arg, index) => arg === args[index]));
        },
        toHaveBeenCalledTimes(times) {
            return calls.length === times;
        },
        toHaveBeenLastCalledWith(...args) {
            if (calls.length === 0)
                return false;
            const lastCall = calls[calls.length - 1];
            return lastCall.length === args.length &&
                lastCall.every((arg, index) => arg === args[index]);
        },
        toHaveBeenNthCalledWith(call, ...args) {
            const targetCall = calls[call - 1]; // 1-based indexing
            if (!targetCall)
                return false;
            return targetCall.length === args.length &&
                targetCall.every((arg, index) => arg === args[index]);
        },
        toHaveReturnedWith(value) {
            return results.some(result => result.type === 'return' && result.value === value);
        },
        toHaveLastReturnedWith(value) {
            if (results.length === 0)
                return false;
            const lastResult = results[results.length - 1];
            return lastResult.type === 'return' && lastResult.value === value;
        },
        toHaveNthReturnedWith(call, value) {
            const targetResult = results[call - 1]; // 1-based indexing
            if (!targetResult)
                return false;
            return targetResult.type === 'return' && targetResult.value === value;
        },
        mockClear() {
            calls.length = 0;
            results.length = 0;
            instances.length = 0;
            contexts.length = 0;
            invocationCallOrder.length = 0;
            return this;
        },
        mockReset() {
            this.mockClear();
            currentImplementation = undefined;
            returnValue = undefined;
            hasReturnValue = false;
            oneTimeReturnValues.length = 0;
            oneTimeImplementations.length = 0;
            resolvedValue = undefined;
            hasResolvedValue = false;
            oneTimeResolvedValues.length = 0;
            rejectedValue = undefined;
            hasRejectedValue = false;
            oneTimeRejectedValues.length = 0;
            return this;
        }
    };
    // Merge the function with the mock API
    return Object.assign(mockFunction, mockAPI);
}
/**
 * Reset the global call order counter
 * Useful for test isolation
 */
function resetGlobalCallOrder() {
    globalCallOrder = 0;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9saWIvbW9ja3MvbW9ja0Z1bmN0aW9uLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7R0FLRzs7QUFpREgsZ0JBME5DO0FBTUQsb0RBRUM7QUF4T0QsMkVBQTJFO0FBQzNFLElBQUksZUFBZSxHQUFHLENBQUMsQ0FBQztBQUV4Qjs7R0FFRztBQUNILFNBQWdCLEVBQUUsQ0FDaEIsY0FBNEM7SUFHNUMsYUFBYTtJQUNiLE1BQU0sS0FBSyxHQUFZLEVBQUUsQ0FBQztJQUMxQixNQUFNLE9BQU8sR0FBb0QsRUFBRSxDQUFDO0lBQ3BFLE1BQU0sU0FBUyxHQUFVLEVBQUUsQ0FBQztJQUM1QixNQUFNLFFBQVEsR0FBVSxFQUFFLENBQUM7SUFDM0IsTUFBTSxtQkFBbUIsR0FBYSxFQUFFLENBQUM7SUFFekMsdUJBQXVCO0lBQ3ZCLElBQUkscUJBQXFCLEdBQUcsY0FBYyxDQUFDO0lBQzNDLElBQUksV0FBVyxHQUF3QixTQUFTLENBQUM7SUFDakQsSUFBSSxjQUFjLEdBQUcsS0FBSyxDQUFDO0lBQzNCLElBQUksbUJBQW1CLEdBQWMsRUFBRSxDQUFDO0lBQ3hDLElBQUksc0JBQXNCLEdBQXVDLEVBQUUsQ0FBQztJQUNwRSxJQUFJLGFBQWEsR0FBUSxTQUFTLENBQUM7SUFDbkMsSUFBSSxnQkFBZ0IsR0FBRyxLQUFLLENBQUM7SUFDN0IsSUFBSSxxQkFBcUIsR0FBVSxFQUFFLENBQUM7SUFDdEMsSUFBSSxhQUFhLEdBQVEsU0FBUyxDQUFDO0lBQ25DLElBQUksZ0JBQWdCLEdBQUcsS0FBSyxDQUFDO0lBQzdCLElBQUkscUJBQXFCLEdBQVUsRUFBRSxDQUFDO0lBRXRDLDJCQUEyQjtJQUMzQixTQUFTLFlBQVksQ0FBWSxHQUFHLElBQVc7UUFDN0Msa0JBQWtCO1FBQ2xCLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDakIsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNwQixTQUFTLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3JCLG1CQUFtQixDQUFDLElBQUksQ0FBQyxFQUFFLGVBQWUsQ0FBQyxDQUFDO1FBRTVDLElBQUksTUFBVyxDQUFDO1FBQ2hCLElBQUksVUFBVSxHQUF1QixRQUFRLENBQUM7UUFFOUMsSUFBSSxDQUFDO1lBQ0gsNEJBQTRCO1lBQzVCLElBQUksV0FBc0QsQ0FBQztZQUUzRCwyQ0FBMkM7WUFDM0MsSUFBSSxzQkFBc0IsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7Z0JBQ3RDLFdBQVcsR0FBRyxzQkFBc0IsQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUMvQyxDQUFDO2lCQUFNLElBQUkscUJBQXFCLEVBQUUsQ0FBQztnQkFDakMsV0FBVyxHQUFHLHFCQUFxQixDQUFDO1lBQ3RDLENBQUM7WUFFRCxzQ0FBc0M7WUFDdEMsSUFBSSxXQUFXLEVBQUUsQ0FBQztnQkFDaEIsTUFBTSxHQUFHLFdBQVcsQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO1lBQ3pDLENBQUM7aUJBQU0sQ0FBQztnQkFDTixvQ0FBb0M7Z0JBQ3BDLElBQUksbUJBQW1CLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO29CQUNuQyxNQUFNLEdBQUcsbUJBQW1CLENBQUMsS0FBSyxFQUFFLENBQUM7Z0JBQ3ZDLENBQUM7cUJBQU0sSUFBSSxjQUFjLEVBQUUsQ0FBQztvQkFDMUIsTUFBTSxHQUFHLFdBQVcsQ0FBQztnQkFDdkIsQ0FBQztxQkFBTSxJQUFJLHFCQUFxQixDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQztvQkFDNUMsTUFBTSxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMscUJBQXFCLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQztnQkFDMUQsQ0FBQztxQkFBTSxJQUFJLGdCQUFnQixFQUFFLENBQUM7b0JBQzVCLE1BQU0sR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDO2dCQUMxQyxDQUFDO3FCQUFNLElBQUkscUJBQXFCLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO29CQUM1QyxNQUFNLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxxQkFBcUIsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDO2dCQUN6RCxDQUFDO3FCQUFNLElBQUksZ0JBQWdCLEVBQUUsQ0FBQztvQkFDNUIsTUFBTSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUM7Z0JBQ3pDLENBQUM7cUJBQU0sQ0FBQztvQkFDTixNQUFNLEdBQUcsU0FBUyxDQUFDO2dCQUNyQixDQUFDO1lBQ0gsQ0FBQztZQUVELGtGQUFrRjtZQUNsRixJQUFJLE1BQU0sSUFBSSxPQUFPLE1BQU0sQ0FBQyxJQUFJLEtBQUssVUFBVSxFQUFFLENBQUM7Z0JBQ2hELE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxLQUFVLEVBQUUsRUFBRTtvQkFDMUIsZ0RBQWdEO29CQUNoRCxNQUFNLGVBQWUsR0FBRyxPQUFPLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztvQkFDM0MsSUFBSSxlQUFlLElBQUksQ0FBQyxFQUFFLENBQUM7d0JBQ3pCLE9BQU8sQ0FBQyxlQUFlLENBQUMsR0FBRyxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxDQUFDO29CQUM3RCxDQUFDO2dCQUNILENBQUMsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztRQUVILENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2YsTUFBTSxHQUFHLEtBQUssQ0FBQztZQUNmLFVBQVUsR0FBRyxPQUFPLENBQUM7WUFDckIsd0NBQXdDO1lBQ3hDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDO1lBQ2xELE1BQU0sS0FBSyxDQUFDO1FBQ2QsQ0FBQztRQUVELG9CQUFvQjtRQUNwQixPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUUsSUFBSSxFQUFFLFVBQVUsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQztRQUNsRCxPQUFPLE1BQU0sQ0FBQztJQUNoQixDQUFDO0lBRUQsMkNBQTJDO0lBQzNDLE1BQU0sT0FBTyxHQUF5QjtRQUNwQyxLQUFLO1FBQ0wsT0FBTztRQUNQLFNBQVM7UUFDVCxRQUFRO1FBQ1IsbUJBQW1CO1FBRW5CLGVBQWUsQ0FBQyxLQUFjO1lBQzVCLFdBQVcsR0FBRyxLQUFLLENBQUM7WUFDcEIsY0FBYyxHQUFHLElBQUksQ0FBQztZQUN0QixPQUFPLElBQUksQ0FBQztRQUNkLENBQUM7UUFFRCxtQkFBbUIsQ0FBQyxLQUFjO1lBQ2hDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUNoQyxPQUFPLElBQUksQ0FBQztRQUNkLENBQUM7UUFFRCxpQkFBaUIsQ0FBQyxLQUFVO1lBQzFCLGFBQWEsR0FBRyxLQUFLLENBQUM7WUFDdEIsZ0JBQWdCLEdBQUcsSUFBSSxDQUFDO1lBQ3hCLE9BQU8sSUFBSSxDQUFDO1FBQ2QsQ0FBQztRQUVELHFCQUFxQixDQUFDLEtBQVU7WUFDOUIscUJBQXFCLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ2xDLE9BQU8sSUFBSSxDQUFDO1FBQ2QsQ0FBQztRQUVELGlCQUFpQixDQUFDLEtBQVU7WUFDMUIsYUFBYSxHQUFHLEtBQUssQ0FBQztZQUN0QixnQkFBZ0IsR0FBRyxJQUFJLENBQUM7WUFDeEIsT0FBTyxJQUFJLENBQUM7UUFDZCxDQUFDO1FBRUQscUJBQXFCLENBQUMsS0FBVTtZQUM5QixxQkFBcUIsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDbEMsT0FBTyxJQUFJLENBQUM7UUFDZCxDQUFDO1FBRUQsa0JBQWtCLENBQUMsRUFBK0I7WUFDaEQscUJBQXFCLEdBQUcsRUFBRSxDQUFDO1lBQzNCLE9BQU8sSUFBSSxDQUFDO1FBQ2QsQ0FBQztRQUVELHNCQUFzQixDQUFDLEVBQStCO1lBQ3BELHNCQUFzQixDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUNoQyxPQUFPLElBQUksQ0FBQztRQUNkLENBQUM7UUFFRCxnQkFBZ0I7WUFDZCxPQUFPLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1FBQzFCLENBQUM7UUFFRCxvQkFBb0IsQ0FBQyxHQUFHLElBQVc7WUFDakMsT0FBTyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQ3ZCLElBQUksQ0FBQyxNQUFNLEtBQUssSUFBSSxDQUFDLE1BQU07Z0JBQzNCLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLEVBQUUsS0FBSyxFQUFFLEVBQUUsQ0FBQyxHQUFHLEtBQUssSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQ2hELENBQUM7UUFDSixDQUFDO1FBRUQscUJBQXFCLENBQUMsS0FBYTtZQUNqQyxPQUFPLEtBQUssQ0FBQyxNQUFNLEtBQUssS0FBSyxDQUFDO1FBQ2hDLENBQUM7UUFFRCx3QkFBd0IsQ0FBQyxHQUFHLElBQVc7WUFDckMsSUFBSSxLQUFLLENBQUMsTUFBTSxLQUFLLENBQUM7Z0JBQUUsT0FBTyxLQUFLLENBQUM7WUFDckMsTUFBTSxRQUFRLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDekMsT0FBTyxRQUFRLENBQUMsTUFBTSxLQUFLLElBQUksQ0FBQyxNQUFNO2dCQUMvQixRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxFQUFFLEtBQUssRUFBRSxFQUFFLENBQUMsR0FBRyxLQUFLLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBQzdELENBQUM7UUFFRCx1QkFBdUIsQ0FBQyxJQUFZLEVBQUUsR0FBRyxJQUFXO1lBQ2xELE1BQU0sVUFBVSxHQUFHLEtBQUssQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxtQkFBbUI7WUFDdkQsSUFBSSxDQUFDLFVBQVU7Z0JBQUUsT0FBTyxLQUFLLENBQUM7WUFDOUIsT0FBTyxVQUFVLENBQUMsTUFBTSxLQUFLLElBQUksQ0FBQyxNQUFNO2dCQUNqQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxFQUFFLEtBQUssRUFBRSxFQUFFLENBQUMsR0FBRyxLQUFLLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBQy9ELENBQUM7UUFFRCxrQkFBa0IsQ0FBQyxLQUFjO1lBQy9CLE9BQU8sT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUMzQixNQUFNLENBQUMsSUFBSSxLQUFLLFFBQVEsSUFBSSxNQUFNLENBQUMsS0FBSyxLQUFLLEtBQUssQ0FDbkQsQ0FBQztRQUNKLENBQUM7UUFFRCxzQkFBc0IsQ0FBQyxLQUFjO1lBQ25DLElBQUksT0FBTyxDQUFDLE1BQU0sS0FBSyxDQUFDO2dCQUFFLE9BQU8sS0FBSyxDQUFDO1lBQ3ZDLE1BQU0sVUFBVSxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQy9DLE9BQU8sVUFBVSxDQUFDLElBQUksS0FBSyxRQUFRLElBQUksVUFBVSxDQUFDLEtBQUssS0FBSyxLQUFLLENBQUM7UUFDcEUsQ0FBQztRQUVELHFCQUFxQixDQUFDLElBQVksRUFBRSxLQUFjO1lBQ2hELE1BQU0sWUFBWSxHQUFHLE9BQU8sQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxtQkFBbUI7WUFDM0QsSUFBSSxDQUFDLFlBQVk7Z0JBQUUsT0FBTyxLQUFLLENBQUM7WUFDaEMsT0FBTyxZQUFZLENBQUMsSUFBSSxLQUFLLFFBQVEsSUFBSSxZQUFZLENBQUMsS0FBSyxLQUFLLEtBQUssQ0FBQztRQUN4RSxDQUFDO1FBRUQsU0FBUztZQUNQLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1lBQ2pCLE9BQU8sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1lBQ25CLFNBQVMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1lBQ3JCLFFBQVEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1lBQ3BCLG1CQUFtQixDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7WUFDL0IsT0FBTyxJQUFJLENBQUM7UUFDZCxDQUFDO1FBRUQsU0FBUztZQUNQLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztZQUNqQixxQkFBcUIsR0FBRyxTQUFTLENBQUM7WUFDbEMsV0FBVyxHQUFHLFNBQVMsQ0FBQztZQUN4QixjQUFjLEdBQUcsS0FBSyxDQUFDO1lBQ3ZCLG1CQUFtQixDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7WUFDL0Isc0JBQXNCLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztZQUNsQyxhQUFhLEdBQUcsU0FBUyxDQUFDO1lBQzFCLGdCQUFnQixHQUFHLEtBQUssQ0FBQztZQUN6QixxQkFBcUIsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1lBQ2pDLGFBQWEsR0FBRyxTQUFTLENBQUM7WUFDMUIsZ0JBQWdCLEdBQUcsS0FBSyxDQUFDO1lBQ3pCLHFCQUFxQixDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7WUFDakMsT0FBTyxJQUFJLENBQUM7UUFDZCxDQUFDO0tBQ0YsQ0FBQztJQUVGLHVDQUF1QztJQUN2QyxPQUFPLE1BQU0sQ0FBQyxNQUFNLENBQUMsWUFBWSxFQUFFLE9BQU8sQ0FBeUQsQ0FBQztBQUN0RyxDQUFDO0FBRUQ7OztHQUdHO0FBQ0gsU0FBZ0Isb0JBQW9CO0lBQ2xDLGVBQWUsR0FBRyxDQUFDLENBQUM7QUFDdEIsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29ya3NwYWNlL2xpYi9tb2Nrcy9tb2NrRnVuY3Rpb24udHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBNb2NrIEZ1bmN0aW9ucyAtIENhbGwgVHJhY2tpbmcgYW5kIEltcGxlbWVudGF0aW9uIENvbnRyb2xcbiAqIFxuICogVGhpcyBtb2R1bGUgcHJvdmlkZXMgSmVzdC9TaW5vbi1jb21wYXRpYmxlIG1vY2sgZnVuY3Rpb24gZnVuY3Rpb25hbGl0eVxuICogd2l0aCBjYWxsIHRyYWNraW5nLCByZXR1cm4gdmFsdWUgY29udHJvbCwgYW5kIGltcGxlbWVudGF0aW9uIHJlcGxhY2VtZW50LlxuICovXG5cbi8vIE1vY2sgZnVuY3Rpb24gY2FsbCByZWNvcmRcbmV4cG9ydCBpbnRlcmZhY2UgTW9ja0NhbGw8VEFyZ3MgZXh0ZW5kcyBhbnlbXSA9IGFueVtdPiB7XG4gIGFyZ3M6IFRBcmdzO1xuICByZXN1bHQ/OiB7IHR5cGU6ICdyZXR1cm4nIHwgJ3Rocm93JzsgdmFsdWU6IGFueSB9O1xuICB0aW1lc3RhbXA6IG51bWJlcjtcbn1cblxuLy8gTW9jayBmdW5jdGlvbiBzdGF0ZSBhbmQgY29udHJvbCBpbnRlcmZhY2VcbmV4cG9ydCBpbnRlcmZhY2UgTW9jazxUQXJncyBleHRlbmRzIGFueVtdID0gYW55W10sIFRSZXR1cm4gPSBhbnk+IHtcbiAgY2FsbHM6IFRBcmdzW107XG4gIHJlc3VsdHM6IEFycmF5PHsgdHlwZTogJ3JldHVybicgfCAndGhyb3cnOyB2YWx1ZTogYW55IH0+O1xuICBpbnN0YW5jZXM6IGFueVtdO1xuICBjb250ZXh0czogYW55W107XG4gIGludm9jYXRpb25DYWxsT3JkZXI6IG51bWJlcltdO1xuICBcbiAgLy8gQ29udHJvbCBtZXRob2RzXG4gIG1vY2tSZXR1cm5WYWx1ZSh2YWx1ZTogVFJldHVybik6IHRoaXM7XG4gIG1vY2tSZXR1cm5WYWx1ZU9uY2UodmFsdWU6IFRSZXR1cm4pOiB0aGlzO1xuICBtb2NrUmVzb2x2ZWRWYWx1ZSh2YWx1ZTogYW55KTogdGhpcztcbiAgbW9ja1Jlc29sdmVkVmFsdWVPbmNlKHZhbHVlOiBhbnkpOiB0aGlzO1xuICBtb2NrUmVqZWN0ZWRWYWx1ZSh2YWx1ZTogYW55KTogdGhpcztcbiAgbW9ja1JlamVjdGVkVmFsdWVPbmNlKHZhbHVlOiBhbnkpOiB0aGlzO1xuICBtb2NrSW1wbGVtZW50YXRpb24oZm46ICguLi5hcmdzOiBUQXJncykgPT4gVFJldHVybik6IHRoaXM7XG4gIG1vY2tJbXBsZW1lbnRhdGlvbk9uY2UoZm46ICguLi5hcmdzOiBUQXJncykgPT4gVFJldHVybik6IHRoaXM7XG4gIFxuICAvLyBJbnNwZWN0aW9uIG1ldGhvZHNcbiAgdG9IYXZlQmVlbkNhbGxlZCgpOiBib29sZWFuO1xuICB0b0hhdmVCZWVuQ2FsbGVkV2l0aCguLi5hcmdzOiBUQXJncyk6IGJvb2xlYW47XG4gIHRvSGF2ZUJlZW5DYWxsZWRUaW1lcyh0aW1lczogbnVtYmVyKTogYm9vbGVhbjtcbiAgdG9IYXZlQmVlbkxhc3RDYWxsZWRXaXRoKC4uLmFyZ3M6IFRBcmdzKTogYm9vbGVhbjtcbiAgdG9IYXZlQmVlbk50aENhbGxlZFdpdGgoY2FsbDogbnVtYmVyLCAuLi5hcmdzOiBUQXJncyk6IGJvb2xlYW47XG4gIHRvSGF2ZVJldHVybmVkV2l0aCh2YWx1ZTogVFJldHVybik6IGJvb2xlYW47XG4gIHRvSGF2ZUxhc3RSZXR1cm5lZFdpdGgodmFsdWU6IFRSZXR1cm4pOiBib29sZWFuO1xuICB0b0hhdmVOdGhSZXR1cm5lZFdpdGgoY2FsbDogbnVtYmVyLCB2YWx1ZTogVFJldHVybik6IGJvb2xlYW47XG4gIFxuICAvLyBSZXNldCBtZXRob2RzXG4gIG1vY2tDbGVhcigpOiB0aGlzO1xuICBtb2NrUmVzZXQoKTogdGhpcztcbiAgbW9ja1Jlc3RvcmU/KCk6IHZvaWQ7XG59XG5cbi8vIEdsb2JhbCBjYWxsIG9yZGVyIGNvdW50ZXIgZm9yIHRyYWNraW5nIGludm9jYXRpb24gb3JkZXIgYWNyb3NzIGFsbCBtb2Nrc1xubGV0IGdsb2JhbENhbGxPcmRlciA9IDA7XG5cbi8qKlxuICogQ3JlYXRlIGEgbW9jayBmdW5jdGlvbiB3aXRoIGNhbGwgdHJhY2tpbmcgYW5kIGltcGxlbWVudGF0aW9uIGNvbnRyb2xcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGZuPFRBcmdzIGV4dGVuZHMgYW55W10gPSBhbnlbXSwgVFJldHVybiA9IGFueT4oXG4gIGltcGxlbWVudGF0aW9uPzogKC4uLmFyZ3M6IFRBcmdzKSA9PiBUUmV0dXJuXG4pOiBNb2NrPFRBcmdzLCBUUmV0dXJuPiAmICgoLi4uYXJnczogVEFyZ3MpID0+IFRSZXR1cm4pIHtcbiAgXG4gIC8vIE1vY2sgc3RhdGVcbiAgY29uc3QgY2FsbHM6IFRBcmdzW10gPSBbXTtcbiAgY29uc3QgcmVzdWx0czogQXJyYXk8eyB0eXBlOiAncmV0dXJuJyB8ICd0aHJvdyc7IHZhbHVlOiBhbnkgfT4gPSBbXTtcbiAgY29uc3QgaW5zdGFuY2VzOiBhbnlbXSA9IFtdO1xuICBjb25zdCBjb250ZXh0czogYW55W10gPSBbXTtcbiAgY29uc3QgaW52b2NhdGlvbkNhbGxPcmRlcjogbnVtYmVyW10gPSBbXTtcbiAgXG4gIC8vIEltcGxlbWVudGF0aW9uIHN0YXRlXG4gIGxldCBjdXJyZW50SW1wbGVtZW50YXRpb24gPSBpbXBsZW1lbnRhdGlvbjtcbiAgbGV0IHJldHVyblZhbHVlOiBUUmV0dXJuIHwgdW5kZWZpbmVkID0gdW5kZWZpbmVkO1xuICBsZXQgaGFzUmV0dXJuVmFsdWUgPSBmYWxzZTtcbiAgbGV0IG9uZVRpbWVSZXR1cm5WYWx1ZXM6IFRSZXR1cm5bXSA9IFtdO1xuICBsZXQgb25lVGltZUltcGxlbWVudGF0aW9uczogQXJyYXk8KC4uLmFyZ3M6IFRBcmdzKSA9PiBUUmV0dXJuPiA9IFtdO1xuICBsZXQgcmVzb2x2ZWRWYWx1ZTogYW55ID0gdW5kZWZpbmVkO1xuICBsZXQgaGFzUmVzb2x2ZWRWYWx1ZSA9IGZhbHNlO1xuICBsZXQgb25lVGltZVJlc29sdmVkVmFsdWVzOiBhbnlbXSA9IFtdO1xuICBsZXQgcmVqZWN0ZWRWYWx1ZTogYW55ID0gdW5kZWZpbmVkO1xuICBsZXQgaGFzUmVqZWN0ZWRWYWx1ZSA9IGZhbHNlO1xuICBsZXQgb25lVGltZVJlamVjdGVkVmFsdWVzOiBhbnlbXSA9IFtdO1xuICBcbiAgLy8gVGhlIGFjdHVhbCBtb2NrIGZ1bmN0aW9uXG4gIGZ1bmN0aW9uIG1vY2tGdW5jdGlvbih0aGlzOiBhbnksIC4uLmFyZ3M6IFRBcmdzKTogVFJldHVybiB7XG4gICAgLy8gUmVjb3JkIHRoZSBjYWxsXG4gICAgY2FsbHMucHVzaChhcmdzKTtcbiAgICBjb250ZXh0cy5wdXNoKHRoaXMpO1xuICAgIGluc3RhbmNlcy5wdXNoKHRoaXMpO1xuICAgIGludm9jYXRpb25DYWxsT3JkZXIucHVzaCgrK2dsb2JhbENhbGxPcmRlcik7XG4gICAgXG4gICAgbGV0IHJlc3VsdDogYW55O1xuICAgIGxldCByZXN1bHRUeXBlOiAncmV0dXJuJyB8ICd0aHJvdycgPSAncmV0dXJuJztcbiAgICBcbiAgICB0cnkge1xuICAgICAgLy8gRGV0ZXJtaW5lIHdoYXQgdG8gZXhlY3V0ZVxuICAgICAgbGV0IGZuVG9FeGVjdXRlOiAoKC4uLmFyZ3M6IFRBcmdzKSA9PiBUUmV0dXJuKSB8IHVuZGVmaW5lZDtcbiAgICAgIFxuICAgICAgLy8gQ2hlY2sgZm9yIG9uZS10aW1lIGltcGxlbWVudGF0aW9ucyBmaXJzdFxuICAgICAgaWYgKG9uZVRpbWVJbXBsZW1lbnRhdGlvbnMubGVuZ3RoID4gMCkge1xuICAgICAgICBmblRvRXhlY3V0ZSA9IG9uZVRpbWVJbXBsZW1lbnRhdGlvbnMuc2hpZnQoKTtcbiAgICAgIH0gZWxzZSBpZiAoY3VycmVudEltcGxlbWVudGF0aW9uKSB7XG4gICAgICAgIGZuVG9FeGVjdXRlID0gY3VycmVudEltcGxlbWVudGF0aW9uO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBFeGVjdXRlIGltcGxlbWVudGF0aW9uIGlmIGF2YWlsYWJsZVxuICAgICAgaWYgKGZuVG9FeGVjdXRlKSB7XG4gICAgICAgIHJlc3VsdCA9IGZuVG9FeGVjdXRlLmFwcGx5KHRoaXMsIGFyZ3MpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gSGFuZGxlIHJldHVybiB2YWx1ZXMgYW5kIHByb21pc2VzXG4gICAgICAgIGlmIChvbmVUaW1lUmV0dXJuVmFsdWVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICByZXN1bHQgPSBvbmVUaW1lUmV0dXJuVmFsdWVzLnNoaWZ0KCk7XG4gICAgICAgIH0gZWxzZSBpZiAoaGFzUmV0dXJuVmFsdWUpIHtcbiAgICAgICAgICByZXN1bHQgPSByZXR1cm5WYWx1ZTtcbiAgICAgICAgfSBlbHNlIGlmIChvbmVUaW1lUmVzb2x2ZWRWYWx1ZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHJlc3VsdCA9IFByb21pc2UucmVzb2x2ZShvbmVUaW1lUmVzb2x2ZWRWYWx1ZXMuc2hpZnQoKSk7XG4gICAgICAgIH0gZWxzZSBpZiAoaGFzUmVzb2x2ZWRWYWx1ZSkge1xuICAgICAgICAgIHJlc3VsdCA9IFByb21pc2UucmVzb2x2ZShyZXNvbHZlZFZhbHVlKTtcbiAgICAgICAgfSBlbHNlIGlmIChvbmVUaW1lUmVqZWN0ZWRWYWx1ZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHJlc3VsdCA9IFByb21pc2UucmVqZWN0KG9uZVRpbWVSZWplY3RlZFZhbHVlcy5zaGlmdCgpKTtcbiAgICAgICAgfSBlbHNlIGlmIChoYXNSZWplY3RlZFZhbHVlKSB7XG4gICAgICAgICAgcmVzdWx0ID0gUHJvbWlzZS5yZWplY3QocmVqZWN0ZWRWYWx1ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzdWx0ID0gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIEhhbmRsZSByZWplY3RlZCBwcm9taXNlcyBieSBjb252ZXJ0aW5nIHRvIHRocm93biBlcnJvcnMgZm9yIGNvbnNpc3RlbnQgdHJhY2tpbmdcbiAgICAgIGlmIChyZXN1bHQgJiYgdHlwZW9mIHJlc3VsdC50aGVuID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIHJlc3VsdC5jYXRjaCgoZXJyb3I6IGFueSkgPT4ge1xuICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgcmVzdWx0IHR5cGUgZm9yIHByb21pc2UgcmVqZWN0aW9uc1xuICAgICAgICAgIGNvbnN0IGxhc3RSZXN1bHRJbmRleCA9IHJlc3VsdHMubGVuZ3RoIC0gMTtcbiAgICAgICAgICBpZiAobGFzdFJlc3VsdEluZGV4ID49IDApIHtcbiAgICAgICAgICAgIHJlc3VsdHNbbGFzdFJlc3VsdEluZGV4XSA9IHsgdHlwZTogJ3Rocm93JywgdmFsdWU6IGVycm9yIH07XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIFxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXN1bHQgPSBlcnJvcjtcbiAgICAgIHJlc3VsdFR5cGUgPSAndGhyb3cnO1xuICAgICAgLy8gUmUtdGhyb3cgdGhlIGVycm9yIGFmdGVyIHJlY29yZGluZyBpdFxuICAgICAgcmVzdWx0cy5wdXNoKHsgdHlwZTogcmVzdWx0VHlwZSwgdmFsdWU6IHJlc3VsdCB9KTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgICBcbiAgICAvLyBSZWNvcmQgdGhlIHJlc3VsdFxuICAgIHJlc3VsdHMucHVzaCh7IHR5cGU6IHJlc3VsdFR5cGUsIHZhbHVlOiByZXN1bHQgfSk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuICBcbiAgLy8gQWRkIG1vY2sgY29udHJvbCBtZXRob2RzIHRvIHRoZSBmdW5jdGlvblxuICBjb25zdCBtb2NrQVBJOiBNb2NrPFRBcmdzLCBUUmV0dXJuPiA9IHtcbiAgICBjYWxscyxcbiAgICByZXN1bHRzLFxuICAgIGluc3RhbmNlcyxcbiAgICBjb250ZXh0cyxcbiAgICBpbnZvY2F0aW9uQ2FsbE9yZGVyLFxuICAgIFxuICAgIG1vY2tSZXR1cm5WYWx1ZSh2YWx1ZTogVFJldHVybikge1xuICAgICAgcmV0dXJuVmFsdWUgPSB2YWx1ZTtcbiAgICAgIGhhc1JldHVyblZhbHVlID0gdHJ1ZTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG4gICAgXG4gICAgbW9ja1JldHVyblZhbHVlT25jZSh2YWx1ZTogVFJldHVybikge1xuICAgICAgb25lVGltZVJldHVyblZhbHVlcy5wdXNoKHZhbHVlKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG4gICAgXG4gICAgbW9ja1Jlc29sdmVkVmFsdWUodmFsdWU6IGFueSkge1xuICAgICAgcmVzb2x2ZWRWYWx1ZSA9IHZhbHVlO1xuICAgICAgaGFzUmVzb2x2ZWRWYWx1ZSA9IHRydWU7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuICAgIFxuICAgIG1vY2tSZXNvbHZlZFZhbHVlT25jZSh2YWx1ZTogYW55KSB7XG4gICAgICBvbmVUaW1lUmVzb2x2ZWRWYWx1ZXMucHVzaCh2YWx1ZSk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuICAgIFxuICAgIG1vY2tSZWplY3RlZFZhbHVlKHZhbHVlOiBhbnkpIHtcbiAgICAgIHJlamVjdGVkVmFsdWUgPSB2YWx1ZTtcbiAgICAgIGhhc1JlamVjdGVkVmFsdWUgPSB0cnVlO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcbiAgICBcbiAgICBtb2NrUmVqZWN0ZWRWYWx1ZU9uY2UodmFsdWU6IGFueSkge1xuICAgICAgb25lVGltZVJlamVjdGVkVmFsdWVzLnB1c2godmFsdWUpO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcbiAgICBcbiAgICBtb2NrSW1wbGVtZW50YXRpb24oZm46ICguLi5hcmdzOiBUQXJncykgPT4gVFJldHVybikge1xuICAgICAgY3VycmVudEltcGxlbWVudGF0aW9uID0gZm47XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuICAgIFxuICAgIG1vY2tJbXBsZW1lbnRhdGlvbk9uY2UoZm46ICguLi5hcmdzOiBUQXJncykgPT4gVFJldHVybikge1xuICAgICAgb25lVGltZUltcGxlbWVudGF0aW9ucy5wdXNoKGZuKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG4gICAgXG4gICAgdG9IYXZlQmVlbkNhbGxlZCgpIHtcbiAgICAgIHJldHVybiBjYWxscy5sZW5ndGggPiAwO1xuICAgIH0sXG4gICAgXG4gICAgdG9IYXZlQmVlbkNhbGxlZFdpdGgoLi4uYXJnczogVEFyZ3MpIHtcbiAgICAgIHJldHVybiBjYWxscy5zb21lKGNhbGwgPT4gXG4gICAgICAgIGNhbGwubGVuZ3RoID09PSBhcmdzLmxlbmd0aCAmJiBcbiAgICAgICAgY2FsbC5ldmVyeSgoYXJnLCBpbmRleCkgPT4gYXJnID09PSBhcmdzW2luZGV4XSlcbiAgICAgICk7XG4gICAgfSxcbiAgICBcbiAgICB0b0hhdmVCZWVuQ2FsbGVkVGltZXModGltZXM6IG51bWJlcikge1xuICAgICAgcmV0dXJuIGNhbGxzLmxlbmd0aCA9PT0gdGltZXM7XG4gICAgfSxcbiAgICBcbiAgICB0b0hhdmVCZWVuTGFzdENhbGxlZFdpdGgoLi4uYXJnczogVEFyZ3MpIHtcbiAgICAgIGlmIChjYWxscy5sZW5ndGggPT09IDApIHJldHVybiBmYWxzZTtcbiAgICAgIGNvbnN0IGxhc3RDYWxsID0gY2FsbHNbY2FsbHMubGVuZ3RoIC0gMV07XG4gICAgICByZXR1cm4gbGFzdENhbGwubGVuZ3RoID09PSBhcmdzLmxlbmd0aCAmJiBcbiAgICAgICAgICAgICBsYXN0Q2FsbC5ldmVyeSgoYXJnLCBpbmRleCkgPT4gYXJnID09PSBhcmdzW2luZGV4XSk7XG4gICAgfSxcbiAgICBcbiAgICB0b0hhdmVCZWVuTnRoQ2FsbGVkV2l0aChjYWxsOiBudW1iZXIsIC4uLmFyZ3M6IFRBcmdzKSB7XG4gICAgICBjb25zdCB0YXJnZXRDYWxsID0gY2FsbHNbY2FsbCAtIDFdOyAvLyAxLWJhc2VkIGluZGV4aW5nXG4gICAgICBpZiAoIXRhcmdldENhbGwpIHJldHVybiBmYWxzZTtcbiAgICAgIHJldHVybiB0YXJnZXRDYWxsLmxlbmd0aCA9PT0gYXJncy5sZW5ndGggJiYgXG4gICAgICAgICAgICAgdGFyZ2V0Q2FsbC5ldmVyeSgoYXJnLCBpbmRleCkgPT4gYXJnID09PSBhcmdzW2luZGV4XSk7XG4gICAgfSxcbiAgICBcbiAgICB0b0hhdmVSZXR1cm5lZFdpdGgodmFsdWU6IFRSZXR1cm4pIHtcbiAgICAgIHJldHVybiByZXN1bHRzLnNvbWUocmVzdWx0ID0+IFxuICAgICAgICByZXN1bHQudHlwZSA9PT0gJ3JldHVybicgJiYgcmVzdWx0LnZhbHVlID09PSB2YWx1ZVxuICAgICAgKTtcbiAgICB9LFxuICAgIFxuICAgIHRvSGF2ZUxhc3RSZXR1cm5lZFdpdGgodmFsdWU6IFRSZXR1cm4pIHtcbiAgICAgIGlmIChyZXN1bHRzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIGZhbHNlO1xuICAgICAgY29uc3QgbGFzdFJlc3VsdCA9IHJlc3VsdHNbcmVzdWx0cy5sZW5ndGggLSAxXTtcbiAgICAgIHJldHVybiBsYXN0UmVzdWx0LnR5cGUgPT09ICdyZXR1cm4nICYmIGxhc3RSZXN1bHQudmFsdWUgPT09IHZhbHVlO1xuICAgIH0sXG4gICAgXG4gICAgdG9IYXZlTnRoUmV0dXJuZWRXaXRoKGNhbGw6IG51bWJlciwgdmFsdWU6IFRSZXR1cm4pIHtcbiAgICAgIGNvbnN0IHRhcmdldFJlc3VsdCA9IHJlc3VsdHNbY2FsbCAtIDFdOyAvLyAxLWJhc2VkIGluZGV4aW5nXG4gICAgICBpZiAoIXRhcmdldFJlc3VsdCkgcmV0dXJuIGZhbHNlO1xuICAgICAgcmV0dXJuIHRhcmdldFJlc3VsdC50eXBlID09PSAncmV0dXJuJyAmJiB0YXJnZXRSZXN1bHQudmFsdWUgPT09IHZhbHVlO1xuICAgIH0sXG4gICAgXG4gICAgbW9ja0NsZWFyKCkge1xuICAgICAgY2FsbHMubGVuZ3RoID0gMDtcbiAgICAgIHJlc3VsdHMubGVuZ3RoID0gMDtcbiAgICAgIGluc3RhbmNlcy5sZW5ndGggPSAwO1xuICAgICAgY29udGV4dHMubGVuZ3RoID0gMDtcbiAgICAgIGludm9jYXRpb25DYWxsT3JkZXIubGVuZ3RoID0gMDtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG4gICAgXG4gICAgbW9ja1Jlc2V0KCkge1xuICAgICAgdGhpcy5tb2NrQ2xlYXIoKTtcbiAgICAgIGN1cnJlbnRJbXBsZW1lbnRhdGlvbiA9IHVuZGVmaW5lZDtcbiAgICAgIHJldHVyblZhbHVlID0gdW5kZWZpbmVkO1xuICAgICAgaGFzUmV0dXJuVmFsdWUgPSBmYWxzZTtcbiAgICAgIG9uZVRpbWVSZXR1cm5WYWx1ZXMubGVuZ3RoID0gMDtcbiAgICAgIG9uZVRpbWVJbXBsZW1lbnRhdGlvbnMubGVuZ3RoID0gMDtcbiAgICAgIHJlc29sdmVkVmFsdWUgPSB1bmRlZmluZWQ7XG4gICAgICBoYXNSZXNvbHZlZFZhbHVlID0gZmFsc2U7XG4gICAgICBvbmVUaW1lUmVzb2x2ZWRWYWx1ZXMubGVuZ3RoID0gMDtcbiAgICAgIHJlamVjdGVkVmFsdWUgPSB1bmRlZmluZWQ7XG4gICAgICBoYXNSZWplY3RlZFZhbHVlID0gZmFsc2U7XG4gICAgICBvbmVUaW1lUmVqZWN0ZWRWYWx1ZXMubGVuZ3RoID0gMDtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgfTtcbiAgXG4gIC8vIE1lcmdlIHRoZSBmdW5jdGlvbiB3aXRoIHRoZSBtb2NrIEFQSVxuICByZXR1cm4gT2JqZWN0LmFzc2lnbihtb2NrRnVuY3Rpb24sIG1vY2tBUEkpIGFzIE1vY2s8VEFyZ3MsIFRSZXR1cm4+ICYgKCguLi5hcmdzOiBUQXJncykgPT4gVFJldHVybik7XG59XG5cbi8qKlxuICogUmVzZXQgdGhlIGdsb2JhbCBjYWxsIG9yZGVyIGNvdW50ZXJcbiAqIFVzZWZ1bCBmb3IgdGVzdCBpc29sYXRpb25cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlc2V0R2xvYmFsQ2FsbE9yZGVyKCk6IHZvaWQge1xuICBnbG9iYWxDYWxsT3JkZXIgPSAwO1xufSJdLCJ2ZXJzaW9uIjozfQ==