b7d577cabc4341d7de4900558ea93099
/**
 * API Key Model - TypeScript Implementation
 *
 * This class focuses solely on API key model functionality and behavior.
 * It extends BaseMockModel with API key-specific methods and properties.
 */
import { BaseMockModel } from './baseMockModel.js';
// Legacy array for backwards compatibility
const mockApiKeys = [];
/**
 * API Key Model Class
 *
 * Provides Mongoose-compatible API key model for testing scenarios.
 * Includes API key-specific validation and methods.
 */
class ApiKey extends BaseMockModel {
    constructor(data = {}) {
        super(data);
        // Set default values specific to ApiKey
        if (!this.createdAt)
            this.createdAt = new Date();
        if (this.isActive === undefined)
            this.isActive = true;
    }
    // Override getCollection to use legacy array for backwards compatibility
    static getCollection() {
        return mockApiKeys;
    }
    // Legacy methods for backward compatibility with existing code
    static findOne(query) {
        console.log(`ApiKey.findOne is running with ${JSON.stringify(query)}`);
        const result = mockApiKeys.find(k => k.key === query.key) || null;
        console.log(`ApiKey.findOne is returning ${result ? 'key' : 'null'}`);
        return Promise.resolve(result);
    }
    static findOneAndDelete(query) {
        console.log(`ApiKey.findOneAndDelete is running with ${JSON.stringify(query)}`);
        const idx = mockApiKeys.findIndex(k => k.key === query.key);
        if (idx === -1) {
            console.log(`ApiKey.findOneAndDelete is returning null`);
            return Promise.resolve(null);
        }
        const deleted = mockApiKeys.splice(idx, 1)[0];
        console.log(`ApiKey.findOneAndDelete is returning deleted key`);
        return Promise.resolve(deleted);
    }
    static findOneAndUpdate(query, update) {
        console.log(`ApiKey.findOneAndUpdate is running with query and update`);
        const key = mockApiKeys.find(k => k.key === query.key);
        if (!key) {
            console.log(`ApiKey.findOneAndUpdate is returning null`);
            return Promise.resolve(null);
        }
        Object.assign(key, update);
        console.log(`ApiKey.findOneAndUpdate is returning updated key`);
        return Promise.resolve(key);
    }
    static find() {
        console.log(`ApiKey.find is running with none`);
        const chain = {
            data: mockApiKeys,
            sort: () => chain,
            lean: () => {
                console.log(`ApiKey.find.lean is returning ${chain.data.length} keys`);
                return Promise.resolve(chain.data);
            },
            exec: () => {
                console.log(`ApiKey.find.exec is returning ${chain.data.length} keys`);
                return Promise.resolve(chain.data);
            }
        };
        return chain;
    }
}
// Export using ES module syntax
export { ApiKey, mockApiKeys };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS91dGlscy9tb2RlbHMvYXBpS2V5TW9kZWwudHMiLCJtYXBwaW5ncyI6IkFBQUE7Ozs7O0dBS0c7QUFFSCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFvQm5ELDJDQUEyQztBQUMzQyxNQUFNLFdBQVcsR0FBVSxFQUFFLENBQUM7QUFFOUI7Ozs7O0dBS0c7QUFDSCxNQUFNLE1BQU8sU0FBUSxhQUFhO0lBT2hDLFlBQVksT0FBbUIsRUFBRTtRQUMvQixLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDWix3Q0FBd0M7UUFDeEMsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTO1lBQUUsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDO1FBQ2pELElBQUksSUFBSSxDQUFDLFFBQVEsS0FBSyxTQUFTO1lBQUUsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUM7SUFDeEQsQ0FBQztJQUVELHlFQUF5RTtJQUN6RSxNQUFNLENBQUMsYUFBYTtRQUNsQixPQUFPLFdBQVcsQ0FBQztJQUNyQixDQUFDO0lBRUQsK0RBQStEO0lBQy9ELE1BQU0sQ0FBQyxPQUFPLENBQUMsS0FBMkM7UUFDeEQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxrQ0FBa0MsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDdkUsTUFBTSxNQUFNLEdBQUcsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLEtBQUssS0FBSyxDQUFDLEdBQUcsQ0FBQyxJQUFJLElBQUksQ0FBQztRQUNsRSxPQUFPLENBQUMsR0FBRyxDQUFDLCtCQUErQixNQUFNLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQztRQUN0RSxPQUFPLE9BQU8sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDakMsQ0FBQztJQUVELE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxLQUEyQztRQUNqRSxPQUFPLENBQUMsR0FBRyxDQUFDLDJDQUEyQyxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNoRixNQUFNLEdBQUcsR0FBRyxXQUFXLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsS0FBSyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDNUQsSUFBSSxHQUFHLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQztZQUNmLE9BQU8sQ0FBQyxHQUFHLENBQUMsMkNBQTJDLENBQUMsQ0FBQztZQUN6RCxPQUFPLE9BQU8sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDL0IsQ0FBQztRQUNELE1BQU0sT0FBTyxHQUFHLFdBQVcsQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzlDLE9BQU8sQ0FBQyxHQUFHLENBQUMsa0RBQWtELENBQUMsQ0FBQztRQUNoRSxPQUFPLE9BQU8sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDbEMsQ0FBQztJQUVELE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxLQUEyQyxFQUFFLE1BQVc7UUFDOUUsT0FBTyxDQUFDLEdBQUcsQ0FBQywwREFBMEQsQ0FBQyxDQUFDO1FBQ3hFLE1BQU0sR0FBRyxHQUFHLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsR0FBRyxLQUFLLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUN2RCxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7WUFDVCxPQUFPLENBQUMsR0FBRyxDQUFDLDJDQUEyQyxDQUFDLENBQUM7WUFDekQsT0FBTyxPQUFPLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQy9CLENBQUM7UUFDRCxNQUFNLENBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxNQUFNLENBQUMsQ0FBQztRQUMzQixPQUFPLENBQUMsR0FBRyxDQUFDLGtEQUFrRCxDQUFDLENBQUM7UUFDaEUsT0FBTyxPQUFPLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQzlCLENBQUM7SUFFRCxNQUFNLENBQUMsSUFBSTtRQUNULE9BQU8sQ0FBQyxHQUFHLENBQUMsa0NBQWtDLENBQUMsQ0FBQztRQUNoRCxNQUFNLEtBQUssR0FBZTtZQUN4QixJQUFJLEVBQUUsV0FBVztZQUNqQixJQUFJLEVBQUUsR0FBRyxFQUFFLENBQUMsS0FBSztZQUNqQixJQUFJLEVBQUUsR0FBRyxFQUFFO2dCQUNULE9BQU8sQ0FBQyxHQUFHLENBQUMsaUNBQWlDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxPQUFPLENBQUMsQ0FBQztnQkFDdkUsT0FBTyxPQUFPLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNyQyxDQUFDO1lBQ0QsSUFBSSxFQUFFLEdBQUcsRUFBRTtnQkFDVCxPQUFPLENBQUMsR0FBRyxDQUFDLGlDQUFpQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sT0FBTyxDQUFDLENBQUM7Z0JBQ3ZFLE9BQU8sT0FBTyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDckMsQ0FBQztTQUNGLENBQUM7UUFDRixPQUFPLEtBQUssQ0FBQztJQUNmLENBQUM7Q0FDRjtBQUVELGdDQUFnQztBQUNoQyxPQUFPLEVBQUUsTUFBTSxFQUFFLFdBQVcsRUFBRSxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3Jrc3BhY2UvdXRpbHMvbW9kZWxzL2FwaUtleU1vZGVsLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQVBJIEtleSBNb2RlbCAtIFR5cGVTY3JpcHQgSW1wbGVtZW50YXRpb25cbiAqIFxuICogVGhpcyBjbGFzcyBmb2N1c2VzIHNvbGVseSBvbiBBUEkga2V5IG1vZGVsIGZ1bmN0aW9uYWxpdHkgYW5kIGJlaGF2aW9yLlxuICogSXQgZXh0ZW5kcyBCYXNlTW9ja01vZGVsIHdpdGggQVBJIGtleS1zcGVjaWZpYyBtZXRob2RzIGFuZCBwcm9wZXJ0aWVzLlxuICovXG5cbmltcG9ydCB7IEJhc2VNb2NrTW9kZWwgfSBmcm9tICcuL2Jhc2VNb2NrTW9kZWwuanMnO1xuXG4vLyBUeXBlIGRlZmluaXRpb25zXG5pbnRlcmZhY2UgQXBpS2V5RGF0YSB7XG4gIF9pZD86IHN0cmluZztcbiAga2V5Pzogc3RyaW5nO1xuICBuYW1lPzogc3RyaW5nO1xuICB1c2VySWQ/OiBzdHJpbmc7XG4gIGlzQWN0aXZlPzogYm9vbGVhbjtcbiAgY3JlYXRlZEF0PzogRGF0ZTtcbiAgW2tleTogc3RyaW5nXTogYW55O1xufVxuXG5pbnRlcmZhY2UgUXVlcnlDaGFpbiB7XG4gIGRhdGE6IGFueVtdO1xuICBzb3J0OiAoKSA9PiBRdWVyeUNoYWluO1xuICBsZWFuOiAoKSA9PiBQcm9taXNlPGFueVtdPjtcbiAgZXhlYzogKCkgPT4gUHJvbWlzZTxhbnlbXT47XG59XG5cbi8vIExlZ2FjeSBhcnJheSBmb3IgYmFja3dhcmRzIGNvbXBhdGliaWxpdHlcbmNvbnN0IG1vY2tBcGlLZXlzOiBhbnlbXSA9IFtdO1xuXG4vKipcbiAqIEFQSSBLZXkgTW9kZWwgQ2xhc3NcbiAqIFxuICogUHJvdmlkZXMgTW9uZ29vc2UtY29tcGF0aWJsZSBBUEkga2V5IG1vZGVsIGZvciB0ZXN0aW5nIHNjZW5hcmlvcy5cbiAqIEluY2x1ZGVzIEFQSSBrZXktc3BlY2lmaWMgdmFsaWRhdGlvbiBhbmQgbWV0aG9kcy5cbiAqL1xuY2xhc3MgQXBpS2V5IGV4dGVuZHMgQmFzZU1vY2tNb2RlbCB7XG4gIHB1YmxpYyBrZXk/OiBzdHJpbmc7XG4gIHB1YmxpYyBuYW1lPzogc3RyaW5nO1xuICBwdWJsaWMgdXNlcklkPzogc3RyaW5nO1xuICBwdWJsaWMgaXNBY3RpdmU/OiBib29sZWFuO1xuICBwdWJsaWMgY3JlYXRlZEF0PzogRGF0ZTtcblxuICBjb25zdHJ1Y3RvcihkYXRhOiBBcGlLZXlEYXRhID0ge30pIHtcbiAgICBzdXBlcihkYXRhKTtcbiAgICAvLyBTZXQgZGVmYXVsdCB2YWx1ZXMgc3BlY2lmaWMgdG8gQXBpS2V5XG4gICAgaWYgKCF0aGlzLmNyZWF0ZWRBdCkgdGhpcy5jcmVhdGVkQXQgPSBuZXcgRGF0ZSgpO1xuICAgIGlmICh0aGlzLmlzQWN0aXZlID09PSB1bmRlZmluZWQpIHRoaXMuaXNBY3RpdmUgPSB0cnVlO1xuICB9XG4gIFxuICAvLyBPdmVycmlkZSBnZXRDb2xsZWN0aW9uIHRvIHVzZSBsZWdhY3kgYXJyYXkgZm9yIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5XG4gIHN0YXRpYyBnZXRDb2xsZWN0aW9uKCk6IGFueVtdIHtcbiAgICByZXR1cm4gbW9ja0FwaUtleXM7XG4gIH1cbiAgXG4gIC8vIExlZ2FjeSBtZXRob2RzIGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5IHdpdGggZXhpc3RpbmcgY29kZVxuICBzdGF0aWMgZmluZE9uZShxdWVyeTogeyBrZXk/OiBzdHJpbmc7IFtrZXk6IHN0cmluZ106IGFueSB9KTogUHJvbWlzZTxhbnkgfCBudWxsPiB7XG4gICAgY29uc29sZS5sb2coYEFwaUtleS5maW5kT25lIGlzIHJ1bm5pbmcgd2l0aCAke0pTT04uc3RyaW5naWZ5KHF1ZXJ5KX1gKTtcbiAgICBjb25zdCByZXN1bHQgPSBtb2NrQXBpS2V5cy5maW5kKGsgPT4gay5rZXkgPT09IHF1ZXJ5LmtleSkgfHwgbnVsbDtcbiAgICBjb25zb2xlLmxvZyhgQXBpS2V5LmZpbmRPbmUgaXMgcmV0dXJuaW5nICR7cmVzdWx0ID8gJ2tleScgOiAnbnVsbCd9YCk7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShyZXN1bHQpO1xuICB9XG4gIFxuICBzdGF0aWMgZmluZE9uZUFuZERlbGV0ZShxdWVyeTogeyBrZXk/OiBzdHJpbmc7IFtrZXk6IHN0cmluZ106IGFueSB9KTogUHJvbWlzZTxhbnkgfCBudWxsPiB7XG4gICAgY29uc29sZS5sb2coYEFwaUtleS5maW5kT25lQW5kRGVsZXRlIGlzIHJ1bm5pbmcgd2l0aCAke0pTT04uc3RyaW5naWZ5KHF1ZXJ5KX1gKTtcbiAgICBjb25zdCBpZHggPSBtb2NrQXBpS2V5cy5maW5kSW5kZXgoayA9PiBrLmtleSA9PT0gcXVlcnkua2V5KTtcbiAgICBpZiAoaWR4ID09PSAtMSkge1xuICAgICAgY29uc29sZS5sb2coYEFwaUtleS5maW5kT25lQW5kRGVsZXRlIGlzIHJldHVybmluZyBudWxsYCk7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG51bGwpO1xuICAgIH1cbiAgICBjb25zdCBkZWxldGVkID0gbW9ja0FwaUtleXMuc3BsaWNlKGlkeCwgMSlbMF07XG4gICAgY29uc29sZS5sb2coYEFwaUtleS5maW5kT25lQW5kRGVsZXRlIGlzIHJldHVybmluZyBkZWxldGVkIGtleWApO1xuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoZGVsZXRlZCk7XG4gIH1cbiAgXG4gIHN0YXRpYyBmaW5kT25lQW5kVXBkYXRlKHF1ZXJ5OiB7IGtleT86IHN0cmluZzsgW2tleTogc3RyaW5nXTogYW55IH0sIHVwZGF0ZTogYW55KTogUHJvbWlzZTxhbnkgfCBudWxsPiB7XG4gICAgY29uc29sZS5sb2coYEFwaUtleS5maW5kT25lQW5kVXBkYXRlIGlzIHJ1bm5pbmcgd2l0aCBxdWVyeSBhbmQgdXBkYXRlYCk7XG4gICAgY29uc3Qga2V5ID0gbW9ja0FwaUtleXMuZmluZChrID0+IGsua2V5ID09PSBxdWVyeS5rZXkpO1xuICAgIGlmICgha2V5KSB7XG4gICAgICBjb25zb2xlLmxvZyhgQXBpS2V5LmZpbmRPbmVBbmRVcGRhdGUgaXMgcmV0dXJuaW5nIG51bGxgKTtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobnVsbCk7XG4gICAgfVxuICAgIE9iamVjdC5hc3NpZ24oa2V5LCB1cGRhdGUpO1xuICAgIGNvbnNvbGUubG9nKGBBcGlLZXkuZmluZE9uZUFuZFVwZGF0ZSBpcyByZXR1cm5pbmcgdXBkYXRlZCBrZXlgKTtcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGtleSk7XG4gIH1cbiAgXG4gIHN0YXRpYyBmaW5kKCk6IFF1ZXJ5Q2hhaW4ge1xuICAgIGNvbnNvbGUubG9nKGBBcGlLZXkuZmluZCBpcyBydW5uaW5nIHdpdGggbm9uZWApO1xuICAgIGNvbnN0IGNoYWluOiBRdWVyeUNoYWluID0geyBcbiAgICAgIGRhdGE6IG1vY2tBcGlLZXlzLFxuICAgICAgc29ydDogKCkgPT4gY2hhaW4sXG4gICAgICBsZWFuOiAoKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKGBBcGlLZXkuZmluZC5sZWFuIGlzIHJldHVybmluZyAke2NoYWluLmRhdGEubGVuZ3RofSBrZXlzYCk7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoY2hhaW4uZGF0YSk7XG4gICAgICB9LFxuICAgICAgZXhlYzogKCkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhgQXBpS2V5LmZpbmQuZXhlYyBpcyByZXR1cm5pbmcgJHtjaGFpbi5kYXRhLmxlbmd0aH0ga2V5c2ApO1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGNoYWluLmRhdGEpO1xuICAgICAgfVxuICAgIH07XG4gICAgcmV0dXJuIGNoYWluO1xuICB9XG59XG5cbi8vIEV4cG9ydCB1c2luZyBFUyBtb2R1bGUgc3ludGF4XG5leHBvcnQgeyBBcGlLZXksIG1vY2tBcGlLZXlzIH07Il0sInZlcnNpb24iOjN9