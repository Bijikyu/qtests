f8bb01c923f084e23448045c9d4cc127
/**
 * Base Mock Model Class
 * 
 * This class focuses solely on providing the foundation for Mongoose-compatible mock models.
 * It handles core model functionality like save, remove, and collection management.
 */

// Global registry for all mock model collections
const mockCollections = new Map();

/**
 * Base Mock Model Class
 * 
 * This class provides the foundation for creating Mongoose-compatible mock models
 * that store data in memory instead of a database. It implements the most commonly
 * used Mongoose model methods for comprehensive testing scenarios.
 */
class BaseMockModel {
  /**
   * Constructor for mock model instances
   * 
   * @param {Object} data - Initial data for the model instance
   */
  constructor(data = {}) {
    console.log(`${this.constructor.name} constructor is running with ${typeof data}`);
    try {
      Object.assign(this, data);

      // Generate _id if not provided (mimics Mongoose behavior)
      if (!this._id) {
        this._id = this.constructor.generateId();
      }
      console.log(`${this.constructor.name} constructor is returning instance`);
    } catch (error) {
      console.log(`${this.constructor.name} constructor error ${error.message}`);
      throw error;
    }
  }

  /**
   * Save instance to in-memory collection
   * 
   * @returns {Promise<Object>} Promise resolving to the saved instance
   */
  save() {
    console.log(`${this.constructor.name}.save is running with instance`);
    try {
      const collection = this.constructor.getCollection();

      // Check if this is an update (document already exists) or a new save
      const existingIndex = collection.findIndex(doc => doc._id === this._id);
      if (existingIndex >= 0) {
        // Update existing document
        collection[existingIndex] = this;
        console.log(`${this.constructor.name}.save is returning updated instance`);
      } else {
        // Add new document
        collection.push(this);
        console.log(`${this.constructor.name}.save is returning new instance`);
      }
      return Promise.resolve(this);
    } catch (error) {
      console.log(`${this.constructor.name}.save error ${error.message}`);
      throw error;
    }
  }

  /**
   * Remove instance from collection
   * 
   * @returns {Promise<Object>} Promise resolving to the removed instance
   */
  remove() {
    console.log(`${this.constructor.name}.remove is running with instance`);
    try {
      const collection = this.constructor.getCollection();
      const index = collection.findIndex(doc => doc._id === this._id);
      if (index >= 0) {
        collection.splice(index, 1);
        console.log(`${this.constructor.name}.remove is returning removed instance`);
        return Promise.resolve(this);
      } else {
        console.log(`${this.constructor.name}.remove is returning null (not found)`);
        return Promise.resolve(null);
      }
    } catch (error) {
      console.log(`${this.constructor.name}.remove error ${error.message}`);
      throw error;
    }
  }

  /**
   * Get or create collection for this model class
   * 
   * @returns {Array} Array serving as the in-memory collection
   */
  static getCollection() {
    const modelName = this.name || 'Anonymous';
    if (!mockCollections.has(modelName)) {
      mockCollections.set(modelName, []);
    }
    return mockCollections.get(modelName);
  }

  /**
   * Clear collection for this model class
   * 
   * Removes all documents from the in-memory collection for this specific model
   */
  static clearCollection() {
    console.log(`${this.name}.clearCollection is running`);
    try {
      const modelName = this.name || 'Anonymous';
      mockCollections.set(modelName, []);
      console.log(`${this.name}.clearCollection completed`);
    } catch (error) {
      console.log(`${this.name}.clearCollection error ${error.message}`);
      throw error;
    }
  }

  /**
   * Delete many documents matching query
   * 
   * @param {Object} query - Query object to match documents for deletion
   * @returns {Promise<Object>} Promise resolving to deletion result
   */
  static deleteMany(query = {}) {
    console.log(`${this.name}.deleteMany is running with ${JSON.stringify(query)}`);
    try {
      const collection = this.getCollection();
      const initialLength = collection.length;

      // Filter out documents that match the query
      const remainingDocs = collection.filter(doc => !this.matchesQuery(doc, query));
      const deletedCount = initialLength - remainingDocs.length;

      // Update the collection
      const modelName = this.name || 'Anonymous';
      mockCollections.set(modelName, remainingDocs);
      console.log(`${this.name}.deleteMany deleted ${deletedCount} documents`);
      return Promise.resolve({
        deletedCount,
        acknowledged: true
      });
    } catch (error) {
      console.log(`${this.name}.deleteMany error ${error.message}`);
      throw error;
    }
  }

  /**
   * Update many documents matching query
   * 
   * @param {Object} query - Query object to match documents for update
   * @param {Object} update - Update object
   * @returns {Promise<Object>} Promise resolving to update result
   */
  static updateMany(query = {}, update = {}) {
    console.log(`${this.name}.updateMany is running with query and update`);
    try {
      const collection = this.getCollection();
      let modifiedCount = 0;
      collection.forEach(doc => {
        if (this.matchesQuery(doc, query)) {
          Object.assign(doc, update);
          modifiedCount++;
        }
      });
      console.log(`${this.name}.updateMany modified ${modifiedCount} documents`);
      return Promise.resolve({
        modifiedCount,
        acknowledged: true
      });
    } catch (error) {
      console.log(`${this.name}.updateMany error ${error.message}`);
      throw error;
    }
  }

  /**
   * Count documents matching query
   * 
   * @param {Object} query - Query object to match documents
   * @returns {Promise<number>} Promise resolving to count
   */
  static countDocuments(query = {}) {
    console.log(`${this.name}.countDocuments is running with ${JSON.stringify(query)}`);
    try {
      const collection = this.getCollection();
      const count = collection.filter(doc => this.matchesQuery(doc, query)).length;
      console.log(`${this.name}.countDocuments is returning ${count}`);
      return Promise.resolve(count);
    } catch (error) {
      console.log(`${this.name}.countDocuments error ${error.message}`);
      throw error;
    }
  }

  /**
   * Generate unique ID for new documents
   * 
   * @returns {string} Unique identifier
   */
  static generateId() {
    return Math.random().toString(36).substr(2, 9) + Date.now().toString(36);
  }

  /**
   * Find documents in collection
   * 
   * @param {Object} query - Query object
   * @returns {Object} Query chain object with lean() method
   */
  static find(query = {}) {
    console.log(`${this.name}.find is running with ${JSON.stringify(query)}`);
    try {
      const collection = this.getCollection();
      const results = collection.filter(doc => this.matchesQuery(doc, query));

      // Return chainable object with lean() method (Mongoose-style)
      const chain = {
        lean() {
          console.log(`${this.name}.find.lean is returning ${results.length} documents`);
          return Promise.resolve(results);
        }
      };
      console.log(`${this.name}.find is returning query chain`);
      return chain;
    } catch (error) {
      console.log(`${this.name}.find error ${error.message}`);
      throw error;
    }
  }

  /**
   * Find one document in collection
   * 
   * @param {Object} query - Query object
   * @returns {Promise<Object|null>} Promise resolving to matching document or null
   */
  static findOne(query = {}) {
    console.log(`${this.name}.findOne is running with ${JSON.stringify(query)}`);
    try {
      const collection = this.getCollection();
      const result = collection.find(doc => this.matchesQuery(doc, query)) || null;
      console.log(`${this.name}.findOne is returning ${result ? 'document' : 'null'}`);
      return Promise.resolve(result);
    } catch (error) {
      console.log(`${this.name}.findOne error ${error.message}`);
      throw error;
    }
  }

  /**
   * Find and update one document
   * 
   * @param {Object} query - Query object
   * @param {Object} update - Update object
   * @param {Object} options - Update options
   * @returns {Promise<Object|null>} Promise resolving to updated document or null
   */
  static findOneAndUpdate(query, update, options = {}) {
    console.log(`${this.name}.findOneAndUpdate is running with query and update`);
    try {
      const collection = this.getCollection();
      const doc = collection.find(d => this.matchesQuery(d, query));
      if (!doc) {
        console.log(`${this.name}.findOneAndUpdate is returning null`);
        return Promise.resolve(null);
      }
      Object.assign(doc, update);
      console.log(`${this.name}.findOneAndUpdate is returning updated document`);
      return Promise.resolve(doc);
    } catch (error) {
      console.log(`${this.name}.findOneAndUpdate error ${error.message}`);
      throw error;
    }
  }

  /**
   * Find and delete one document
   * 
   * @param {Object} query - Query object
   * @returns {Promise<Object|null>} Promise resolving to deleted document or null
   */
  static findOneAndDelete(query) {
    console.log(`${this.name}.findOneAndDelete is running with ${JSON.stringify(query)}`);
    try {
      const collection = this.getCollection();
      const index = collection.findIndex(doc => this.matchesQuery(doc, query));
      if (index === -1) {
        console.log(`${this.name}.findOneAndDelete is returning null`);
        return Promise.resolve(null);
      }
      const deleted = collection.splice(index, 1)[0];
      console.log(`${this.name}.findOneAndDelete is returning deleted document`);
      return Promise.resolve(deleted);
    } catch (error) {
      console.log(`${this.name}.findOneAndDelete error ${error.message}`);
      throw error;
    }
  }

  /**
   * Check if document matches query
   * 
   * @param {Object} doc - Document to test
   * @param {Object} query - Query object with field/value pairs
   * @returns {boolean} True if document matches query
   */
  static matchesQuery(doc, query) {
    if (!query || Object.keys(query).length === 0) {
      return true; // empty query matches all documents
    }
    for (const [field, value] of Object.entries(query)) {
      if (doc[field] !== value) {
        return false; // field doesn't match
      }
    }
    return true; // all fields match
  }
}
module.exports = {
  BaseMockModel,
  mockCollections
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtb2NrQ29sbGVjdGlvbnMiLCJNYXAiLCJCYXNlTW9ja01vZGVsIiwiY29uc3RydWN0b3IiLCJkYXRhIiwiY29uc29sZSIsImxvZyIsIm5hbWUiLCJPYmplY3QiLCJhc3NpZ24iLCJfaWQiLCJnZW5lcmF0ZUlkIiwiZXJyb3IiLCJtZXNzYWdlIiwic2F2ZSIsImNvbGxlY3Rpb24iLCJnZXRDb2xsZWN0aW9uIiwiZXhpc3RpbmdJbmRleCIsImZpbmRJbmRleCIsImRvYyIsInB1c2giLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlbW92ZSIsImluZGV4Iiwic3BsaWNlIiwibW9kZWxOYW1lIiwiaGFzIiwic2V0IiwiZ2V0IiwiY2xlYXJDb2xsZWN0aW9uIiwiZGVsZXRlTWFueSIsInF1ZXJ5IiwiSlNPTiIsInN0cmluZ2lmeSIsImluaXRpYWxMZW5ndGgiLCJsZW5ndGgiLCJyZW1haW5pbmdEb2NzIiwiZmlsdGVyIiwibWF0Y2hlc1F1ZXJ5IiwiZGVsZXRlZENvdW50IiwiYWNrbm93bGVkZ2VkIiwidXBkYXRlTWFueSIsInVwZGF0ZSIsIm1vZGlmaWVkQ291bnQiLCJmb3JFYWNoIiwiY291bnREb2N1bWVudHMiLCJjb3VudCIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInN1YnN0ciIsIkRhdGUiLCJub3ciLCJmaW5kIiwicmVzdWx0cyIsImNoYWluIiwibGVhbiIsImZpbmRPbmUiLCJyZXN1bHQiLCJmaW5kT25lQW5kVXBkYXRlIiwib3B0aW9ucyIsImQiLCJmaW5kT25lQW5kRGVsZXRlIiwiZGVsZXRlZCIsImtleXMiLCJmaWVsZCIsInZhbHVlIiwiZW50cmllcyIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJiYXNlTW9ja01vZGVsLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQmFzZSBNb2NrIE1vZGVsIENsYXNzXG4gKiBcbiAqIFRoaXMgY2xhc3MgZm9jdXNlcyBzb2xlbHkgb24gcHJvdmlkaW5nIHRoZSBmb3VuZGF0aW9uIGZvciBNb25nb29zZS1jb21wYXRpYmxlIG1vY2sgbW9kZWxzLlxuICogSXQgaGFuZGxlcyBjb3JlIG1vZGVsIGZ1bmN0aW9uYWxpdHkgbGlrZSBzYXZlLCByZW1vdmUsIGFuZCBjb2xsZWN0aW9uIG1hbmFnZW1lbnQuXG4gKi9cblxuLy8gR2xvYmFsIHJlZ2lzdHJ5IGZvciBhbGwgbW9jayBtb2RlbCBjb2xsZWN0aW9uc1xuY29uc3QgbW9ja0NvbGxlY3Rpb25zID0gbmV3IE1hcCgpO1xuXG4vKipcbiAqIEJhc2UgTW9jayBNb2RlbCBDbGFzc1xuICogXG4gKiBUaGlzIGNsYXNzIHByb3ZpZGVzIHRoZSBmb3VuZGF0aW9uIGZvciBjcmVhdGluZyBNb25nb29zZS1jb21wYXRpYmxlIG1vY2sgbW9kZWxzXG4gKiB0aGF0IHN0b3JlIGRhdGEgaW4gbWVtb3J5IGluc3RlYWQgb2YgYSBkYXRhYmFzZS4gSXQgaW1wbGVtZW50cyB0aGUgbW9zdCBjb21tb25seVxuICogdXNlZCBNb25nb29zZSBtb2RlbCBtZXRob2RzIGZvciBjb21wcmVoZW5zaXZlIHRlc3Rpbmcgc2NlbmFyaW9zLlxuICovXG5jbGFzcyBCYXNlTW9ja01vZGVsIHtcbiAgLyoqXG4gICAqIENvbnN0cnVjdG9yIGZvciBtb2NrIG1vZGVsIGluc3RhbmNlc1xuICAgKiBcbiAgICogQHBhcmFtIHtPYmplY3R9IGRhdGEgLSBJbml0aWFsIGRhdGEgZm9yIHRoZSBtb2RlbCBpbnN0YW5jZVxuICAgKi9cbiAgY29uc3RydWN0b3IoZGF0YSA9IHt9KSB7XG4gICAgY29uc29sZS5sb2coYCR7dGhpcy5jb25zdHJ1Y3Rvci5uYW1lfSBjb25zdHJ1Y3RvciBpcyBydW5uaW5nIHdpdGggJHt0eXBlb2YgZGF0YX1gKTtcbiAgICBcbiAgICB0cnkge1xuICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLCBkYXRhKTtcbiAgICAgIFxuICAgICAgLy8gR2VuZXJhdGUgX2lkIGlmIG5vdCBwcm92aWRlZCAobWltaWNzIE1vbmdvb3NlIGJlaGF2aW9yKVxuICAgICAgaWYgKCF0aGlzLl9pZCkge1xuICAgICAgICB0aGlzLl9pZCA9IHRoaXMuY29uc3RydWN0b3IuZ2VuZXJhdGVJZCgpO1xuICAgICAgfVxuICAgICAgXG4gICAgICBjb25zb2xlLmxvZyhgJHt0aGlzLmNvbnN0cnVjdG9yLm5hbWV9IGNvbnN0cnVjdG9yIGlzIHJldHVybmluZyBpbnN0YW5jZWApO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmxvZyhgJHt0aGlzLmNvbnN0cnVjdG9yLm5hbWV9IGNvbnN0cnVjdG9yIGVycm9yICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuICBcbiAgLyoqXG4gICAqIFNhdmUgaW5zdGFuY2UgdG8gaW4tbWVtb3J5IGNvbGxlY3Rpb25cbiAgICogXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPE9iamVjdD59IFByb21pc2UgcmVzb2x2aW5nIHRvIHRoZSBzYXZlZCBpbnN0YW5jZVxuICAgKi9cbiAgc2F2ZSgpIHtcbiAgICBjb25zb2xlLmxvZyhgJHt0aGlzLmNvbnN0cnVjdG9yLm5hbWV9LnNhdmUgaXMgcnVubmluZyB3aXRoIGluc3RhbmNlYCk7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGNvbGxlY3Rpb24gPSB0aGlzLmNvbnN0cnVjdG9yLmdldENvbGxlY3Rpb24oKTtcbiAgICAgIFxuICAgICAgLy8gQ2hlY2sgaWYgdGhpcyBpcyBhbiB1cGRhdGUgKGRvY3VtZW50IGFscmVhZHkgZXhpc3RzKSBvciBhIG5ldyBzYXZlXG4gICAgICBjb25zdCBleGlzdGluZ0luZGV4ID0gY29sbGVjdGlvbi5maW5kSW5kZXgoZG9jID0+IGRvYy5faWQgPT09IHRoaXMuX2lkKTtcbiAgICAgIFxuICAgICAgaWYgKGV4aXN0aW5nSW5kZXggPj0gMCkge1xuICAgICAgICAvLyBVcGRhdGUgZXhpc3RpbmcgZG9jdW1lbnRcbiAgICAgICAgY29sbGVjdGlvbltleGlzdGluZ0luZGV4XSA9IHRoaXM7XG4gICAgICAgIGNvbnNvbGUubG9nKGAke3RoaXMuY29uc3RydWN0b3IubmFtZX0uc2F2ZSBpcyByZXR1cm5pbmcgdXBkYXRlZCBpbnN0YW5jZWApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gQWRkIG5ldyBkb2N1bWVudFxuICAgICAgICBjb2xsZWN0aW9uLnB1c2godGhpcyk7XG4gICAgICAgIGNvbnNvbGUubG9nKGAke3RoaXMuY29uc3RydWN0b3IubmFtZX0uc2F2ZSBpcyByZXR1cm5pbmcgbmV3IGluc3RhbmNlYCk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodGhpcyk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUubG9nKGAke3RoaXMuY29uc3RydWN0b3IubmFtZX0uc2F2ZSBlcnJvciAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cbiAgXG4gIC8qKlxuICAgKiBSZW1vdmUgaW5zdGFuY2UgZnJvbSBjb2xsZWN0aW9uXG4gICAqIFxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxPYmplY3Q+fSBQcm9taXNlIHJlc29sdmluZyB0byB0aGUgcmVtb3ZlZCBpbnN0YW5jZVxuICAgKi9cbiAgcmVtb3ZlKCkge1xuICAgIGNvbnNvbGUubG9nKGAke3RoaXMuY29uc3RydWN0b3IubmFtZX0ucmVtb3ZlIGlzIHJ1bm5pbmcgd2l0aCBpbnN0YW5jZWApO1xuICAgIFxuICAgIHRyeSB7XG4gICAgICBjb25zdCBjb2xsZWN0aW9uID0gdGhpcy5jb25zdHJ1Y3Rvci5nZXRDb2xsZWN0aW9uKCk7XG4gICAgICBjb25zdCBpbmRleCA9IGNvbGxlY3Rpb24uZmluZEluZGV4KGRvYyA9PiBkb2MuX2lkID09PSB0aGlzLl9pZCk7XG4gICAgICBcbiAgICAgIGlmIChpbmRleCA+PSAwKSB7XG4gICAgICAgIGNvbGxlY3Rpb24uc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgY29uc29sZS5sb2coYCR7dGhpcy5jb25zdHJ1Y3Rvci5uYW1lfS5yZW1vdmUgaXMgcmV0dXJuaW5nIHJlbW92ZWQgaW5zdGFuY2VgKTtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh0aGlzKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGAke3RoaXMuY29uc3RydWN0b3IubmFtZX0ucmVtb3ZlIGlzIHJldHVybmluZyBudWxsIChub3QgZm91bmQpYCk7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobnVsbCk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUubG9nKGAke3RoaXMuY29uc3RydWN0b3IubmFtZX0ucmVtb3ZlIGVycm9yICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuICBcbiAgLyoqXG4gICAqIEdldCBvciBjcmVhdGUgY29sbGVjdGlvbiBmb3IgdGhpcyBtb2RlbCBjbGFzc1xuICAgKiBcbiAgICogQHJldHVybnMge0FycmF5fSBBcnJheSBzZXJ2aW5nIGFzIHRoZSBpbi1tZW1vcnkgY29sbGVjdGlvblxuICAgKi9cbiAgc3RhdGljIGdldENvbGxlY3Rpb24oKSB7XG4gICAgY29uc3QgbW9kZWxOYW1lID0gdGhpcy5uYW1lIHx8ICdBbm9ueW1vdXMnO1xuICAgIFxuICAgIGlmICghbW9ja0NvbGxlY3Rpb25zLmhhcyhtb2RlbE5hbWUpKSB7XG4gICAgICBtb2NrQ29sbGVjdGlvbnMuc2V0KG1vZGVsTmFtZSwgW10pO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4gbW9ja0NvbGxlY3Rpb25zLmdldChtb2RlbE5hbWUpO1xuICB9XG4gIFxuICAvKipcbiAgICogQ2xlYXIgY29sbGVjdGlvbiBmb3IgdGhpcyBtb2RlbCBjbGFzc1xuICAgKiBcbiAgICogUmVtb3ZlcyBhbGwgZG9jdW1lbnRzIGZyb20gdGhlIGluLW1lbW9yeSBjb2xsZWN0aW9uIGZvciB0aGlzIHNwZWNpZmljIG1vZGVsXG4gICAqL1xuICBzdGF0aWMgY2xlYXJDb2xsZWN0aW9uKCkge1xuICAgIGNvbnNvbGUubG9nKGAke3RoaXMubmFtZX0uY2xlYXJDb2xsZWN0aW9uIGlzIHJ1bm5pbmdgKTtcbiAgICBcbiAgICB0cnkge1xuICAgICAgY29uc3QgbW9kZWxOYW1lID0gdGhpcy5uYW1lIHx8ICdBbm9ueW1vdXMnO1xuICAgICAgbW9ja0NvbGxlY3Rpb25zLnNldChtb2RlbE5hbWUsIFtdKTtcbiAgICAgIGNvbnNvbGUubG9nKGAke3RoaXMubmFtZX0uY2xlYXJDb2xsZWN0aW9uIGNvbXBsZXRlZGApO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmxvZyhgJHt0aGlzLm5hbWV9LmNsZWFyQ29sbGVjdGlvbiBlcnJvciAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cbiAgXG4gIC8qKlxuICAgKiBEZWxldGUgbWFueSBkb2N1bWVudHMgbWF0Y2hpbmcgcXVlcnlcbiAgICogXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBxdWVyeSAtIFF1ZXJ5IG9iamVjdCB0byBtYXRjaCBkb2N1bWVudHMgZm9yIGRlbGV0aW9uXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPE9iamVjdD59IFByb21pc2UgcmVzb2x2aW5nIHRvIGRlbGV0aW9uIHJlc3VsdFxuICAgKi9cbiAgc3RhdGljIGRlbGV0ZU1hbnkocXVlcnkgPSB7fSkge1xuICAgIGNvbnNvbGUubG9nKGAke3RoaXMubmFtZX0uZGVsZXRlTWFueSBpcyBydW5uaW5nIHdpdGggJHtKU09OLnN0cmluZ2lmeShxdWVyeSl9YCk7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGNvbGxlY3Rpb24gPSB0aGlzLmdldENvbGxlY3Rpb24oKTtcbiAgICAgIGNvbnN0IGluaXRpYWxMZW5ndGggPSBjb2xsZWN0aW9uLmxlbmd0aDtcbiAgICAgIFxuICAgICAgLy8gRmlsdGVyIG91dCBkb2N1bWVudHMgdGhhdCBtYXRjaCB0aGUgcXVlcnlcbiAgICAgIGNvbnN0IHJlbWFpbmluZ0RvY3MgPSBjb2xsZWN0aW9uLmZpbHRlcihkb2MgPT4gIXRoaXMubWF0Y2hlc1F1ZXJ5KGRvYywgcXVlcnkpKTtcbiAgICAgIGNvbnN0IGRlbGV0ZWRDb3VudCA9IGluaXRpYWxMZW5ndGggLSByZW1haW5pbmdEb2NzLmxlbmd0aDtcbiAgICAgIFxuICAgICAgLy8gVXBkYXRlIHRoZSBjb2xsZWN0aW9uXG4gICAgICBjb25zdCBtb2RlbE5hbWUgPSB0aGlzLm5hbWUgfHwgJ0Fub255bW91cyc7XG4gICAgICBtb2NrQ29sbGVjdGlvbnMuc2V0KG1vZGVsTmFtZSwgcmVtYWluaW5nRG9jcyk7XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKGAke3RoaXMubmFtZX0uZGVsZXRlTWFueSBkZWxldGVkICR7ZGVsZXRlZENvdW50fSBkb2N1bWVudHNgKTtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoeyBkZWxldGVkQ291bnQsIGFja25vd2xlZGdlZDogdHJ1ZSB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5sb2coYCR7dGhpcy5uYW1lfS5kZWxldGVNYW55IGVycm9yICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuICBcbiAgLyoqXG4gICAqIFVwZGF0ZSBtYW55IGRvY3VtZW50cyBtYXRjaGluZyBxdWVyeVxuICAgKiBcbiAgICogQHBhcmFtIHtPYmplY3R9IHF1ZXJ5IC0gUXVlcnkgb2JqZWN0IHRvIG1hdGNoIGRvY3VtZW50cyBmb3IgdXBkYXRlXG4gICAqIEBwYXJhbSB7T2JqZWN0fSB1cGRhdGUgLSBVcGRhdGUgb2JqZWN0XG4gICAqIEByZXR1cm5zIHtQcm9taXNlPE9iamVjdD59IFByb21pc2UgcmVzb2x2aW5nIHRvIHVwZGF0ZSByZXN1bHRcbiAgICovXG4gIHN0YXRpYyB1cGRhdGVNYW55KHF1ZXJ5ID0ge30sIHVwZGF0ZSA9IHt9KSB7XG4gICAgY29uc29sZS5sb2coYCR7dGhpcy5uYW1lfS51cGRhdGVNYW55IGlzIHJ1bm5pbmcgd2l0aCBxdWVyeSBhbmQgdXBkYXRlYCk7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGNvbGxlY3Rpb24gPSB0aGlzLmdldENvbGxlY3Rpb24oKTtcbiAgICAgIGxldCBtb2RpZmllZENvdW50ID0gMDtcbiAgICAgIFxuICAgICAgY29sbGVjdGlvbi5mb3JFYWNoKGRvYyA9PiB7XG4gICAgICAgIGlmICh0aGlzLm1hdGNoZXNRdWVyeShkb2MsIHF1ZXJ5KSkge1xuICAgICAgICAgIE9iamVjdC5hc3NpZ24oZG9jLCB1cGRhdGUpO1xuICAgICAgICAgIG1vZGlmaWVkQ291bnQrKztcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKGAke3RoaXMubmFtZX0udXBkYXRlTWFueSBtb2RpZmllZCAke21vZGlmaWVkQ291bnR9IGRvY3VtZW50c2ApO1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7IG1vZGlmaWVkQ291bnQsIGFja25vd2xlZGdlZDogdHJ1ZSB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5sb2coYCR7dGhpcy5uYW1lfS51cGRhdGVNYW55IGVycm9yICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuICBcbiAgLyoqXG4gICAqIENvdW50IGRvY3VtZW50cyBtYXRjaGluZyBxdWVyeVxuICAgKiBcbiAgICogQHBhcmFtIHtPYmplY3R9IHF1ZXJ5IC0gUXVlcnkgb2JqZWN0IHRvIG1hdGNoIGRvY3VtZW50c1xuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxudW1iZXI+fSBQcm9taXNlIHJlc29sdmluZyB0byBjb3VudFxuICAgKi9cbiAgc3RhdGljIGNvdW50RG9jdW1lbnRzKHF1ZXJ5ID0ge30pIHtcbiAgICBjb25zb2xlLmxvZyhgJHt0aGlzLm5hbWV9LmNvdW50RG9jdW1lbnRzIGlzIHJ1bm5pbmcgd2l0aCAke0pTT04uc3RyaW5naWZ5KHF1ZXJ5KX1gKTtcbiAgICBcbiAgICB0cnkge1xuICAgICAgY29uc3QgY29sbGVjdGlvbiA9IHRoaXMuZ2V0Q29sbGVjdGlvbigpO1xuICAgICAgY29uc3QgY291bnQgPSBjb2xsZWN0aW9uLmZpbHRlcihkb2MgPT4gdGhpcy5tYXRjaGVzUXVlcnkoZG9jLCBxdWVyeSkpLmxlbmd0aDtcbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coYCR7dGhpcy5uYW1lfS5jb3VudERvY3VtZW50cyBpcyByZXR1cm5pbmcgJHtjb3VudH1gKTtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoY291bnQpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmxvZyhgJHt0aGlzLm5hbWV9LmNvdW50RG9jdW1lbnRzIGVycm9yICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuICBcbiAgLyoqXG4gICAqIEdlbmVyYXRlIHVuaXF1ZSBJRCBmb3IgbmV3IGRvY3VtZW50c1xuICAgKiBcbiAgICogQHJldHVybnMge3N0cmluZ30gVW5pcXVlIGlkZW50aWZpZXJcbiAgICovXG4gIHN0YXRpYyBnZW5lcmF0ZUlkKCkge1xuICAgIHJldHVybiBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSkgKyBEYXRlLm5vdygpLnRvU3RyaW5nKDM2KTtcbiAgfVxuICBcbiAgLyoqXG4gICAqIEZpbmQgZG9jdW1lbnRzIGluIGNvbGxlY3Rpb25cbiAgICogXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBxdWVyeSAtIFF1ZXJ5IG9iamVjdFxuICAgKiBAcmV0dXJucyB7T2JqZWN0fSBRdWVyeSBjaGFpbiBvYmplY3Qgd2l0aCBsZWFuKCkgbWV0aG9kXG4gICAqL1xuICBzdGF0aWMgZmluZChxdWVyeSA9IHt9KSB7XG4gICAgY29uc29sZS5sb2coYCR7dGhpcy5uYW1lfS5maW5kIGlzIHJ1bm5pbmcgd2l0aCAke0pTT04uc3RyaW5naWZ5KHF1ZXJ5KX1gKTtcbiAgICBcbiAgICB0cnkge1xuICAgICAgY29uc3QgY29sbGVjdGlvbiA9IHRoaXMuZ2V0Q29sbGVjdGlvbigpO1xuICAgICAgY29uc3QgcmVzdWx0cyA9IGNvbGxlY3Rpb24uZmlsdGVyKGRvYyA9PiB0aGlzLm1hdGNoZXNRdWVyeShkb2MsIHF1ZXJ5KSk7XG4gICAgICBcbiAgICAgIC8vIFJldHVybiBjaGFpbmFibGUgb2JqZWN0IHdpdGggbGVhbigpIG1ldGhvZCAoTW9uZ29vc2Utc3R5bGUpXG4gICAgICBjb25zdCBjaGFpbiA9IHtcbiAgICAgICAgbGVhbigpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhgJHt0aGlzLm5hbWV9LmZpbmQubGVhbiBpcyByZXR1cm5pbmcgJHtyZXN1bHRzLmxlbmd0aH0gZG9jdW1lbnRzYCk7XG4gICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShyZXN1bHRzKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coYCR7dGhpcy5uYW1lfS5maW5kIGlzIHJldHVybmluZyBxdWVyeSBjaGFpbmApO1xuICAgICAgcmV0dXJuIGNoYWluO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmxvZyhgJHt0aGlzLm5hbWV9LmZpbmQgZXJyb3IgJHtlcnJvci5tZXNzYWdlfWApO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG4gIFxuICAvKipcbiAgICogRmluZCBvbmUgZG9jdW1lbnQgaW4gY29sbGVjdGlvblxuICAgKiBcbiAgICogQHBhcmFtIHtPYmplY3R9IHF1ZXJ5IC0gUXVlcnkgb2JqZWN0XG4gICAqIEByZXR1cm5zIHtQcm9taXNlPE9iamVjdHxudWxsPn0gUHJvbWlzZSByZXNvbHZpbmcgdG8gbWF0Y2hpbmcgZG9jdW1lbnQgb3IgbnVsbFxuICAgKi9cbiAgc3RhdGljIGZpbmRPbmUocXVlcnkgPSB7fSkge1xuICAgIGNvbnNvbGUubG9nKGAke3RoaXMubmFtZX0uZmluZE9uZSBpcyBydW5uaW5nIHdpdGggJHtKU09OLnN0cmluZ2lmeShxdWVyeSl9YCk7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGNvbGxlY3Rpb24gPSB0aGlzLmdldENvbGxlY3Rpb24oKTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGNvbGxlY3Rpb24uZmluZChkb2MgPT4gdGhpcy5tYXRjaGVzUXVlcnkoZG9jLCBxdWVyeSkpIHx8IG51bGw7XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKGAke3RoaXMubmFtZX0uZmluZE9uZSBpcyByZXR1cm5pbmcgJHtyZXN1bHQgPyAnZG9jdW1lbnQnIDogJ251bGwnfWApO1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShyZXN1bHQpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmxvZyhgJHt0aGlzLm5hbWV9LmZpbmRPbmUgZXJyb3IgJHtlcnJvci5tZXNzYWdlfWApO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG4gIFxuICAvKipcbiAgICogRmluZCBhbmQgdXBkYXRlIG9uZSBkb2N1bWVudFxuICAgKiBcbiAgICogQHBhcmFtIHtPYmplY3R9IHF1ZXJ5IC0gUXVlcnkgb2JqZWN0XG4gICAqIEBwYXJhbSB7T2JqZWN0fSB1cGRhdGUgLSBVcGRhdGUgb2JqZWN0XG4gICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIC0gVXBkYXRlIG9wdGlvbnNcbiAgICogQHJldHVybnMge1Byb21pc2U8T2JqZWN0fG51bGw+fSBQcm9taXNlIHJlc29sdmluZyB0byB1cGRhdGVkIGRvY3VtZW50IG9yIG51bGxcbiAgICovXG4gIHN0YXRpYyBmaW5kT25lQW5kVXBkYXRlKHF1ZXJ5LCB1cGRhdGUsIG9wdGlvbnMgPSB7fSkge1xuICAgIGNvbnNvbGUubG9nKGAke3RoaXMubmFtZX0uZmluZE9uZUFuZFVwZGF0ZSBpcyBydW5uaW5nIHdpdGggcXVlcnkgYW5kIHVwZGF0ZWApO1xuICAgIFxuICAgIHRyeSB7XG4gICAgICBjb25zdCBjb2xsZWN0aW9uID0gdGhpcy5nZXRDb2xsZWN0aW9uKCk7XG4gICAgICBjb25zdCBkb2MgPSBjb2xsZWN0aW9uLmZpbmQoZCA9PiB0aGlzLm1hdGNoZXNRdWVyeShkLCBxdWVyeSkpO1xuICAgICAgXG4gICAgICBpZiAoIWRvYykge1xuICAgICAgICBjb25zb2xlLmxvZyhgJHt0aGlzLm5hbWV9LmZpbmRPbmVBbmRVcGRhdGUgaXMgcmV0dXJuaW5nIG51bGxgKTtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShudWxsKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgT2JqZWN0LmFzc2lnbihkb2MsIHVwZGF0ZSk7XG4gICAgICBjb25zb2xlLmxvZyhgJHt0aGlzLm5hbWV9LmZpbmRPbmVBbmRVcGRhdGUgaXMgcmV0dXJuaW5nIHVwZGF0ZWQgZG9jdW1lbnRgKTtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoZG9jKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5sb2coYCR7dGhpcy5uYW1lfS5maW5kT25lQW5kVXBkYXRlIGVycm9yICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuICBcbiAgLyoqXG4gICAqIEZpbmQgYW5kIGRlbGV0ZSBvbmUgZG9jdW1lbnRcbiAgICogXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBxdWVyeSAtIFF1ZXJ5IG9iamVjdFxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxPYmplY3R8bnVsbD59IFByb21pc2UgcmVzb2x2aW5nIHRvIGRlbGV0ZWQgZG9jdW1lbnQgb3IgbnVsbFxuICAgKi9cbiAgc3RhdGljIGZpbmRPbmVBbmREZWxldGUocXVlcnkpIHtcbiAgICBjb25zb2xlLmxvZyhgJHt0aGlzLm5hbWV9LmZpbmRPbmVBbmREZWxldGUgaXMgcnVubmluZyB3aXRoICR7SlNPTi5zdHJpbmdpZnkocXVlcnkpfWApO1xuICAgIFxuICAgIHRyeSB7XG4gICAgICBjb25zdCBjb2xsZWN0aW9uID0gdGhpcy5nZXRDb2xsZWN0aW9uKCk7XG4gICAgICBjb25zdCBpbmRleCA9IGNvbGxlY3Rpb24uZmluZEluZGV4KGRvYyA9PiB0aGlzLm1hdGNoZXNRdWVyeShkb2MsIHF1ZXJ5KSk7XG4gICAgICBcbiAgICAgIGlmIChpbmRleCA9PT0gLTEpIHtcbiAgICAgICAgY29uc29sZS5sb2coYCR7dGhpcy5uYW1lfS5maW5kT25lQW5kRGVsZXRlIGlzIHJldHVybmluZyBudWxsYCk7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobnVsbCk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGNvbnN0IGRlbGV0ZWQgPSBjb2xsZWN0aW9uLnNwbGljZShpbmRleCwgMSlbMF07XG4gICAgICBjb25zb2xlLmxvZyhgJHt0aGlzLm5hbWV9LmZpbmRPbmVBbmREZWxldGUgaXMgcmV0dXJuaW5nIGRlbGV0ZWQgZG9jdW1lbnRgKTtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoZGVsZXRlZCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUubG9nKGAke3RoaXMubmFtZX0uZmluZE9uZUFuZERlbGV0ZSBlcnJvciAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cbiAgXG4gIC8qKlxuICAgKiBDaGVjayBpZiBkb2N1bWVudCBtYXRjaGVzIHF1ZXJ5XG4gICAqIFxuICAgKiBAcGFyYW0ge09iamVjdH0gZG9jIC0gRG9jdW1lbnQgdG8gdGVzdFxuICAgKiBAcGFyYW0ge09iamVjdH0gcXVlcnkgLSBRdWVyeSBvYmplY3Qgd2l0aCBmaWVsZC92YWx1ZSBwYWlyc1xuICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gVHJ1ZSBpZiBkb2N1bWVudCBtYXRjaGVzIHF1ZXJ5XG4gICAqL1xuICBzdGF0aWMgbWF0Y2hlc1F1ZXJ5KGRvYywgcXVlcnkpIHtcbiAgICBpZiAoIXF1ZXJ5IHx8IE9iamVjdC5rZXlzKHF1ZXJ5KS5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiB0cnVlOyAvLyBlbXB0eSBxdWVyeSBtYXRjaGVzIGFsbCBkb2N1bWVudHNcbiAgICB9XG4gICAgXG4gICAgZm9yIChjb25zdCBbZmllbGQsIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhxdWVyeSkpIHtcbiAgICAgIGlmIChkb2NbZmllbGRdICE9PSB2YWx1ZSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7IC8vIGZpZWxkIGRvZXNuJ3QgbWF0Y2hcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHRydWU7IC8vIGFsbCBmaWVsZHMgbWF0Y2hcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgQmFzZU1vY2tNb2RlbCxcbiAgbW9ja0NvbGxlY3Rpb25zXG59OyJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsTUFBTUEsZUFBZSxHQUFHLElBQUlDLEdBQUcsQ0FBQyxDQUFDOztBQUVqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU1DLGFBQWEsQ0FBQztFQUNsQjtBQUNGO0FBQ0E7QUFDQTtBQUNBO0VBQ0VDLFdBQVdBLENBQUNDLElBQUksR0FBRyxDQUFDLENBQUMsRUFBRTtJQUNyQkMsT0FBTyxDQUFDQyxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUNILFdBQVcsQ0FBQ0ksSUFBSSxnQ0FBZ0MsT0FBT0gsSUFBSSxFQUFFLENBQUM7SUFFbEYsSUFBSTtNQUNGSSxNQUFNLENBQUNDLE1BQU0sQ0FBQyxJQUFJLEVBQUVMLElBQUksQ0FBQzs7TUFFekI7TUFDQSxJQUFJLENBQUMsSUFBSSxDQUFDTSxHQUFHLEVBQUU7UUFDYixJQUFJLENBQUNBLEdBQUcsR0FBRyxJQUFJLENBQUNQLFdBQVcsQ0FBQ1EsVUFBVSxDQUFDLENBQUM7TUFDMUM7TUFFQU4sT0FBTyxDQUFDQyxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUNILFdBQVcs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STtNQUNGLE1BQU1qQixVQUFVLEdBQUcsSUFBSSxDQUFDQyxhQUFhLENBQUMsQ0FBQztNQUN2QyxNQUFNUSxLQUFLLEdBQUdULFVBQVUsQ0FBQ0csU0FBUyxDQUFDQyxHQUFHLElBQUksSUFBSSxDQUFDb0IsWUFBWSxDQUFDcEIsR0FBRyxFQUFFYSxLQUFLLENBQUMsQ0FBQztNQUV4RSxJQUFJUixLQUFLLEtBQUssQ0FBQyxDQUFDLEVBQUU7UUFDaEJuQixPQUFPLENBQUNDLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQ0MsSUFBSSxxQ0FBcUMsQ0FBQztRQUM5RCxPQUFPYyxPQUFPLENBQUNDLE9BQU8sQ0FBQyxJQUFJLENBQUM7TUFDOUI7TUFFQSxNQUFNMEMsT0FBTyxHQUFHakQsVUFBVSxDQUFDVSxNQUFNLENBQUNELEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7TUFDOUNuQixPQUFPLENBQUNDLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQ0MsSUFBSSxpREFBaUQsQ0FBQztNQUMxRSxPQUFPYyxPQUFPLENBQUNDLE9BQU8sQ0FBQzBDLE9BQU8sQ0FBQztJQUNqQyxDQUFDLENBQUMsT0FBT3BELEtBQUssRUFBRTtNQUNkUCxPQUFPLENBQUNDLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQ0MsSUFBSSwyQkFBMkJLLEtBQUssQ0FBQ0MsT0FBTyxFQUFFLENBQUM7TUFDbkUsTUFBTUQsS0FBSztJQUNiO0VBQ0Y7O0VBRUE7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7RUFDRSxPQUFPMkIsWUFBWUEsQ0FBQ3BCLEdBQUcsRUFBRWEsS0FBSyxFQUFFO0lBQzlCLElBQUksQ0FBQ0EsS0FBSyxJQUFJeEIsTUFBTSxDQUFDeUQsSUFBSSxDQUFDakMsS0FBSyxDQUFDLENBQUNJLE1BQU0sS0FBSyxDQUFDLEVBQUU7TUFDN0MsT0FBTyxJQUFJLENBQUMsQ0FBQztJQUNmO0lBRUEsS0FBSyxNQUFNLENBQUM4QixLQUFLLEVBQUVDLEtBQUssQ0FBQyxJQUFJM0QsTUFBTSxDQUFDNEQsT0FBTyxDQUFDcEMsS0FBSyxDQUFDLEVBQUU7TUFDbEQsSUFBSWIsR0FBRyxDQUFDK0MsS0FBSyxDQUFDLEtBQUtDLEtBQUssRUFBRTtRQUN4QixPQUFPLEtBQUssQ0FBQyxDQUFDO01BQ2hCO0lBQ0Y7SUFFQSxPQUFPLElBQUksQ0FBQyxDQUFDO0VBQ2Y7QUFDRjtBQUVBRSxNQUFNLENBQUNDLE9BQU8sR0FBRztFQUNmcEUsYUFBYTtFQUNiRjtBQUNGLENBQUMiLCJpZ25vcmVMaXN0IjpbXX0=