{"version":3,"names":["attachMockSpies","makeLoggedMock","require","vm","withMockConsole","test","mock","expect","mockClear","toBe","mockReset","toBeDefined","saved","global","jest","attachIsolated","runInNewContext","toString","undefined","logStart","logReturn","toBeUndefined","spy","logs","calls","map","c","some","log","includes"],"sources":["mockUtils.test.js"],"sourcesContent":["const { attachMockSpies, makeLoggedMock } = require('../utils/testEnv'); // (import spy helpers)\nconst vm = require('vm'); // (node vm for isolated context)\nconst { withMockConsole } = require('../utils/testHelpers'); // (helper for log spies)\n\n// Ensure attachMockSpies provides jest.fn helpers when jest is present\ntest('attachMockSpies uses jest spies when available', () => {\n  const mock = function(){}; // (simple mock target)\n  attachMockSpies(mock); // (enhance mock)\n  expect(typeof mock.mockClear).toBe('function'); // (mockClear present)\n  expect(typeof mock.mockReset).toBe('function'); // (mockReset present)\n  expect(mock.mockClear.mock).toBeDefined(); // (jest.fn applied)\n  expect(mock.mockReset.mock).toBeDefined(); // (jest.fn applied)\n});\n\n// Ensure attachMockSpies falls back to plain functions when jest is missing\ntest('attachMockSpies adds noops without jest', () => {\n  const saved = global.jest; // (backup jest global)\n  delete global.jest; // (simulate non-jest env)\n  const attachIsolated = vm.runInNewContext(`(${attachMockSpies.toString()})`, { jest: undefined, logStart: () => {}, logReturn: () => {} }); // (recreate helper without jest)\n  const mock = function(){}; // (mock to enhance)\n  attachIsolated(mock); // (apply helper in vm context)\n  expect(typeof mock.mockClear).toBe('function'); // (mockClear created)\n  expect(typeof mock.mockReset).toBe('function'); // (mockReset created)\n  expect(mock.mockClear.mock).toBeUndefined(); // (not a jest.fn)\n  expect(mock.mockReset.mock).toBeUndefined(); // (not a jest.fn)\n  global.jest = saved; // (restore jest global)\n});\n\n// Verify makeLoggedMock logs execution and returns enhanced mock\ntest('makeLoggedMock logs and returns mock with spies', () => withMockConsole('log', spy => {\n  const mock = makeLoggedMock('sample', () => ({})); // (create logged mock)\n  const logs = spy.mock.calls.map(c => c[0]); // (capture log lines)\n  expect(logs.some(log => log.includes('makeLoggedMock is running'))).toBe(true); // (start log present)\n  expect(logs.some(log => log.includes('makeLoggedMock is returning'))).toBe(true); // (end log present)\n  expect(typeof mock.mockClear).toBe('function'); // (mockClear exists)\n  expect(typeof mock.mockReset).toBe('function'); // (mockReset exists)\n}));\n"],"mappings":"AAAA,MAAM;EAAEA,eAAe;EAAEC;AAAe,CAAC,GAAGC,OAAO,CAAC,kBAAkB,CAAC,CAAC,CAAC;AACzE,MAAMC,EAAE,GAAGD,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC;AAC1B,MAAM;EAAEE;AAAgB,CAAC,GAAGF,OAAO,CAAC,sBAAsB,CAAC,CAAC,CAAC;;AAE7D;AACAG,IAAI,CAAC,gDAAgD,EAAE,MAAM;EAC3D,MAAMC,IAAI,GAAG,SAAAA,CAAA,EAAU,CAAC,CAAC,CAAC,CAAC;EAC3BN,eAAe,CAACM,IAAI,CAAC,CAAC,CAAC;EACvBC,MAAM,CAAC,OAAOD,IAAI,CAACE,SAAS,CAAC,CAACC,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC;EAChDF,MAAM,CAAC,OAAOD,IAAI,CAACI,SAAS,CAAC,CAACD,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC;EAChDF,MAAM,CAACD,IAAI,CAACE,SAAS,CAACF,IAAI,CAAC,CAACK,WAAW,CAAC,CAAC,CAAC,CAAC;EAC3CJ,MAAM,CAACD,IAAI,CAACI,SAAS,CAACJ,IAAI,CAAC,CAACK,WAAW,CAAC,CAAC,CAAC,CAAC;AAC7C,CAAC,CAAC;;AAEF;AACAN,IAAI,CAAC,yCAAyC,EAAE,MAAM;EACpD,MAAMO,KAAK,GAAGC,MAAM,CAACC,IAAI,CAAC,CAAC;EAC3B,OAAOD,MAAM,CAACC,IAAI,CAAC,CAAC;EACpB,MAAMC,cAAc,GAAGZ,EAAE,CAACa,eAAe,CAAC,IAAIhB,eAAe,CAACiB,QAAQ,CAAC,CAAC,GAAG,EAAE;IAAEH,IAAI,EAAEI,SAAS;IAAEC,QAAQ,EAAEA,CAAA,KAAM,CAAC,CAAC;IAAEC,SAAS,EAAEA,CAAA,KAAM,CAAC;EAAE,CAAC,CAAC,CAAC,CAAC;EAC5I,MAAMd,IAAI,GAAG,SAAAA,CAAA,EAAU,CAAC,CAAC,CAAC,CAAC;EAC3BS,cAAc,CAACT,IAAI,CAAC,CAAC,CAAC;EACtBC,MAAM,CAAC,OAAOD,IAAI,CAACE,SAAS,CAAC,CAACC,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC;EAChDF,MAAM,CAAC,OAAOD,IAAI,CAACI,SAAS,CAAC,CAACD,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC;EAChDF,MAAM,CAACD,IAAI,CAACE,SAAS,CAACF,IAAI,CAAC,CAACe,aAAa,CAAC,CAAC,CAAC,CAAC;EAC7Cd,MAAM,CAACD,IAAI,CAACI,SAAS,CAACJ,IAAI,CAAC,CAACe,aAAa,CAAC,CAAC,CAAC,CAAC;EAC7CR,MAAM,CAACC,IAAI,GAAGF,KAAK,CAAC,CAAC;AACvB,CAAC,CAAC;;AAEF;AACAP,IAAI,CAAC,iDAAiD,EAAE,MAAMD,eAAe,CAAC,KAAK,EAAEkB,GAAG,IAAI;EAC1F,MAAMhB,IAAI,GAAGL,cAAc,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;EACnD,MAAMsB,IAAI,GAAGD,GAAG,CAAChB,IAAI,CAACkB,KAAK,CAACC,GAAG,CAACC,CAAC,IAAIA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;EAC5CnB,MAAM,CAACgB,IAAI,CAACI,IAAI,CAACC,GAAG,IAAIA,GAAG,CAACC,QAAQ,CAAC,2BAA2B,CAAC,CAAC,CAAC,CAACpB,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;EAChFF,MAAM,CAACgB,IAAI,CAACI,IAAI,CAACC,GAAG,IAAIA,GAAG,CAACC,QAAQ,CAAC,6BAA6B,CAAC,CAAC,CAAC,CAACpB,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;EAClFF,MAAM,CAAC,OAAOD,IAAI,CAACE,SAAS,CAAC,CAACC,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC;EAChDF,MAAM,CAAC,OAAOD,IAAI,CAACI,SAAS,CAAC,CAACD,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC;AAClD,CAAC,CAAC,CAAC","ignoreList":[]}