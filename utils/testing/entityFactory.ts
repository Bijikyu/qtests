/** Entity Factory Functions */
import{logStart,logReturn}from'../../lib/logUtils.js';import{User,ApiKey,LogEntry}from'./dataTypes.js';import{JEST_WORKER_ID,QTESTS_PARALLEL_MODE}from'../../config/localVars.js';import{createTimestamp}from'../helpers/timeUtils.js';
class EntityFactory{private static counter=0;static nextId():string|number{const isJestParallel=JEST_WORKER_ID&&JEST_WORKER_ID!=='1';const isExplicitParallel=QTESTS_PARALLEL_MODE==='true';if(!isJestParallel&&!isExplicitParallel){return++this.counter;}const hrTime=process.hrtime.bigint();const random=Math.random().toString(36).substring(2,11);return`${hrTime}-${random}`;}static createUser(overrides:Partial<User>={}):User{logStart('EntityFactory.createUser',overrides);const id=this.nextId();const user:User={id:`user-${id}`,username:`testuser${id}`,email:`test${id}@example.com`,password:`hashedpassword${id}`,firstName:'Test',lastName:`User${id}`,isActive:true,createdAt:createTimestamp(),updatedAt:createTimestamp(),...overrides};logReturn('EntityFactory.createUser',user);return user;}static createApiKey(overrides:Partial<ApiKey>={}):ApiKey{logStart('EntityFactory.createApiKey',overrides);const id=this.nextId();const apiKey:ApiKey={id:`key-${id}`,key:`test-api-key-${id}-${Math.random().toString(36).substring(2,11)}`,name:`Test API Key ${id}`,userId:`user-${id}`,isActive:true,permissions:['read','write'],createdAt:new Date(),expiresAt:new Date(Date.now()+30*24*60*60*1000),...overrides};logReturn('EntityFactory.createApiKey',apiKey);return apiKey;}static createLogEntry(overrides:Partial<LogEntry>={}):LogEntry{logStart('EntityFactory.createLogEntry',overrides);const id=this.nextId();const logEntry:LogEntry={id:`log-${id}`,level:'info',message:`Test log message ${id}`,timestamp:new Date(),userId:`user-${id}`,source:'test-system',...overrides};logReturn('EntityFactory.createLogEntry',logEntry);return logEntry;}static createUsers(count:number,baseOverrides:Partial<User>={}):User[]{logStart('EntityFactory.createUsers',count,baseOverrides);const users:User[]=[];for(let i=0;i<count;i++){const overrides={...baseOverrides};if(overrides.username){overrides.username=`${overrides.username}${i+1}`;}if(overrides.email){overrides.email=`test${i+1}@example.com`;}users.push(this.createUser(overrides));}logReturn('EntityFactory.createUsers',users);return users;}static resetCounter():void{this.counter=0;}}
export{EntityFactory};